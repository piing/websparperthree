(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.List=c.List||{};g=c.Abbrev=c.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=b&&b.Obj;l=g.Slot=g.Slot||{};m=g.Async=g.Async||{};n=g.Mailbox=g.Mailbox||{};o=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};p=c.AppendList=c.AppendList||{};q=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};r=c.DomUtility=c.DomUtility||{};s=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};t=c.Trie=c.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI$Trie=a.StartupCode$WebSharper_UI$Trie||{};w=c.Snap=c.Snap||{};x=c.Var=c.Var||{};y=c.View=c.View||{};z=c.ConcreteVar=c.ConcreteVar||{};A=c.Var$1=c.Var$1||{};B=c.Updates=c.Updates||{};C=c.FromView=c.FromView||{};D=c.ViewBuilder=c.ViewBuilder||{};E=c.Submitter=c.Submitter||{};F=c.Key=c.Key||{};G=c.Model=c.Model||{};H=c.Serializer=c.Serializer||{};I=c.Storage=c.Storage||{};J=I.ArrayStorage=I.ArrayStorage||{};K=I.LocalStorageBackend=I.LocalStorageBackend||{};L=c.ListModel=c.ListModel||{};M=c.ListModels=c.ListModels||{};N=a.StartupCode$WebSharper_UI$Models=a.StartupCode$WebSharper_UI$Models||{};O=c.ReactiveExtensions=c.ReactiveExtensions||{};P=c.DoubleInterpolation=c.DoubleInterpolation||{};Q=c.Interpolation=c.Interpolation||{};R=c.Easing=c.Easing||{};S=c.Easings=c.Easings||{};T=c.An=c.An||{};U=c.Anims=c.Anims||{};V=c.Trans=c.Trans||{};W=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};X=b&&b.Web;Y=X&&X.Control;Z=c.OnAfterRenderControl=c.OnAfterRenderControl||{};_0=c.AnimatedAttrNode=c.AnimatedAttrNode||{};_1=c.DynamicAttrNode=c.DynamicAttrNode||{};_2=c.AttrProxy=c.AttrProxy||{};_3=c.Client=c.Client||{};_4=_3.Attrs=_3.Attrs||{};_5=_4.Dyn=_4.Dyn||{};_6=c.Attrs=c.Attrs||{};_7=c.CheckedInput=c.CheckedInput||{};_8=c.BindVar=c.BindVar||{};_9=c.AttrModule=c.AttrModule||{};_=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};$=X&&X.FSharpInlineControl;ba=c.InlineControlWithPlaceHolder=c.InlineControlWithPlaceHolder||{};bb=_3.Settings=_3.Settings||{};bc=c.DocElemNode=c.DocElemNode||{};bd=_3.Docs=_3.Docs||{};be=bd.DomNodes=bd.DomNodes||{};bf=bd.NodeSet=bd.NodeSet||{};bg=bd.RunState=bd.RunState||{};bh=c.Docs=c.Docs||{};bi=c.Doc=c.Doc||{};bj=c.Elt=c.Elt||{};bk=_3.EltUpdater=_3.EltUpdater||{};bl=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bm=_3.Templates=_3.Templates||{};bn=bm.Prepare=bm.Prepare||{};bo=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};bp=c.Flow=c.Flow||{};bq=c.FlowBuilder=c.FlowBuilder||{};br=c.HtmlModule=c.HtmlModule||{};bs=br.attr=br.attr||{};bt=c.Router=c.Router||{};bu=c.Route=c.Route||{};bv=c.Routing=c.Routing||{};bw=c.RouteMap=c.RouteMap||{};bx=c.Input=c.Input||{};by=bx.MousePosSt=bx.MousePosSt||{};bz=bx.MouseBtnSt=bx.MouseBtnSt||{};bA=bx.Mouse=bx.Mouse||{};bB=bx.KeyListenerSt=bx.KeyListenerSt||{};bC=bx.Keyboard=bx.Keyboard||{};bD=a.StartupCode$WebSharper_UI$Input=a.StartupCode$WebSharper_UI$Input||{};bE=b&&b.List;bF=b&&b.Arrays;bG=b&&b.Enumerator;bH=b&&b.Strings;bI=b&&b.Char;bJ=b&&b.Collections;bK=bJ&&bJ.HashSet;bL=b&&b.Seq;bM=b&&b.Runtime;bN=b&&b.Unchecked;bO=a.console;bP=b&&b.Concurrency;bQ=bJ&&bJ.Map;bR=bJ&&bJ.FSharpMap;bS=b&&b.Operators;bT=b&&b.Queue;bU=b&&b.Lazy;bV=bJ&&bJ.Dictionary;bW=a.JSON;bX=b&&b.Numeric;bY=a.Node;bZ=b&&b.Slice;b0=b&&b.Sitelets;b1=b0&&b0.RouterModule;b2=b0&&b0.Route;b3=b&&b.Utils;b4=b&&b.Option;d.mapInPlace=function(b5,b6){var b7,b8;for(b7=0,b8=b6.length-1;b7<=b8;b7++)b6[b7]=b5(b6[b7]);return b6;};d.ofSeqNonCopying=function(b5){var b6,b7;if(b5 instanceof a.Array)return b5;else if(b5 instanceof bE.T)return bF.ofList(b5);else if(b5===null)return[];else{b6=[];b7=bG.Get(b5);try{while(b7.MoveNext())b6.push(b7.Current());return b6;}finally{if(typeof b7=="object"&&"Dispose"in b7)b7.Dispose();}}};d.MapTreeReduce=function(b5,b6,b7,b8){var b9;function b_(b$){return function(ca){var cb,cc;switch(ca<=0?0:ca===1?b$>=0&&b$<b9?1:(cb=ca,2):(cb=ca,2)){case 0:return b6;case 1:return b5(bF.get(b8,b$));case 2:cc=ca/2>>0;return b7((b_(b$))(cc),(b_(b$+cc))(ca-cc));}};}b9=bF.length(b8);return(b_(0))(b9);};d.TreeReduce=function(b5,b6,b7){var b8;function b9(b_){return function(b$){var ca,cb;switch(b$<=0?0:b$===1?b_>=0&&b_<b8?1:(ca=b$,2):(ca=b$,2)){case 0:return b5;case 1:return bF.get(b7,b_);case 2:cb=b$/2>>0;return b6((b9(b_))(cb),(b9(b_+cb))(b$-cb));}};}b8=bF.length(b7);return(b9(0))(b8);};e.isBlank=function(b5){return bH.forall(bI.IsWhiteSpace,b5);};f.maybeReplaceFirst=function(b5,b6,b7){var b8;b8=[false];return bE.map(function(b9){var b_;return!b8[0]&&b5(b9)?(b_=b6(b9),b_==null?b9:b_.$0):b9;},b7);};f.replaceFirst=function(b5,b6,b7){var b8;b8=[false];return bE.map(function(b9){return!b8[0]&&b5(b9)?b6(b9):b9;},b7);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(b5){o.$cctor();o.counter=b5;};i.Filter=function(b5,b6){return new bK.New$2(bF.filter(b5,i.ToArray(b6)));};i.Intersect=function(b5,b6){var b7;b7=new bK.New$2(i.ToArray(b5));b7.IntersectWith(i.ToArray(b6));return b7;};i.Except=function(b5,b6){var b7;b7=new bK.New$2(i.ToArray(b6));b7.ExceptWith(i.ToArray(b5));return b7;};i.ToArray=function(b5){var b6;b6=bF.create(b5.Count(),void 0);b5.CopyTo(b6,0);return b6;};j.ToValueArray=function(b5){var b6;b6=bF.create(b5.count,void 0);bL.iteri(function(b7,b8){return bF.set(b6,b7,b8.V);},b5);return b6;};j.ToKeyArray=function(b5){var b6;b6=bF.create(b5.count,void 0);bL.iteri(function(b7,b8){return bF.set(b6,b7,b8.K);},b5);return b6;};l=g.Slot=bM.Class({GetHashCode:function(){return bN.Hash(this.key(this.value));},Equals:function(b5){return bN.Equals(this.key(this.value),this.key(b5.get_Value()));},get_Value:function(){return this.value;}},k,l);l.New=bM.Ctor(function(b5,b6){k.New.call(this);this.key=b5;this.value=b6;},l);l.Create=function(b5,b6){return new l.New(b5,b6);};m.OnError=function(b5){return bO.log("WebSharper UI: Uncaught asynchronous exception",b5);};m.StartTo=function(b5,b6){bP.StartWithContinuations(b5,b6,function(b7){m.OnError(b7);},a.ignore,null);};n.StartProcessor=function(b5){var b6;function b7(){var b8;b8=null;return bP.Delay(function(){return bP.Bind(b5,function(){var b9;b9=b6[0];return bN.Equals(b9,1)?(b6[0]=0,bP.Zero()):bN.Equals(b9,2)?(b6[0]=1,b7()):bP.Zero();});});}b6=[0];return function(){var b8;b8=b6[0];if(bN.Equals(b8,0)){b6[0]=1;bP.Start(b7(),null);}else bN.Equals(b8,1)?b6[0]=2:void 0;};};o.$cctor=function(){o.$cctor=a.ignore;o.counter=0;};p.FromArray=function(b5){var b6;b6=b5.length;return b6===0?{$:0}:b6===1?{$:1,$0:bF.get(b5,0)}:{$:3,$0:b5.slice()};};p.ToArray=function(b5){var b6;function b7(b8){var b9,b_;while(true)if(b8.$==1)return b6.push(b8.$0);else if(b8.$==2){b9=b8.$1;b_=b8.$0;b7(b_);b8=b9;}else return b8.$==3?bF.iter(function(b$){b6.push(b$);},b8.$0):null;}b6=[];b7(b5);return b6.slice(0);};p.Single=function(b5){return{$:1,$0:b5};};p.Concat=function(b5){var b6;b6=d.ofSeqNonCopying(b5);return d.TreeReduce(p.Empty(),p.Append,b6);};p.Append=function(b5,b6){return b5.$==0?b6:b6.$==0?b5:{$:2,$0:b5,$1:b6};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=function(){q.$cctor=a.ignore;q.Empty={$:0};};r.ParseHTMLIntoFakeRoot=function(b5){var b6,b7,b8,b9,b_;function b$(ca,cb){var cc;while(true)if(cb===0)return ca;else{cc=cb;ca=ca.lastChild;cb=cc-1;}}b6=self.document.createElement("div");return!r.rhtml().test(b5)?(b6.appendChild(self.document.createTextNode(b5)),b6):(b7=(b8=r.rtagName().exec(b5),bN.Equals(b8,null)?"":bF.get(b8,1).toLowerCase()),(b9=(b_=(r.wrapMap())[b7],b_?b_:r.defaultWrap()),(b6.innerHTML=b9[1]+b5.replace(r.rxhtmlTag(),"<$1></$2>")+b9[2],b$(b6,b9[0]))));};r.defaultWrap=function(){s.$cctor();return s.defaultWrap;};r.wrapMap=function(){s.$cctor();return s.wrapMap;};r.rhtml=function(){s.$cctor();return s.rhtml;};r.rtagName=function(){s.$cctor();return s.rtagName;};r.rxhtmlTag=function(){s.$cctor();return s.rxhtmlTag;};r.IterSelector=function(b5,b6,b7){var b8,b9,b_;b8=b5.querySelectorAll(b6);for(b9=0,b_=b8.length-1;b9<=b_;b9++)b7(b8[b9]);};r.ChildrenArray=function(b5){var b6,b7,b8;b6=[];for(b7=0,b8=b5.childNodes.length-1;b7<=b8;b7++)b6.push(b5.childNodes[b7]);return b6;};r.RemoveClass=function(b5,b6){var b7;r.setClass(b5,(b7=r.clsRE(b6),r.getClass(b5).replace(b7,function(b8,b9,b_){return b9===""||b_===""?"":" ";})));};r.AddClass=function(b5,b6){var b7;b7=r.getClass(b5);if(b7==="")r.setClass(b5,b6);else!r.clsRE(b6).test(b7)?r.setClass(b5,b7+" "+b6):void 0;};r.setClass=function(b5,b6){if(b5 instanceof a.SVGElement)b5.setAttribute("class",b6);else b5.className=b6;};r.getClass=function(b5){return b5 instanceof a.SVGElement?b5.getAttribute("class"):b5.className;};r.clsRE=function(b5){return new a.RegExp("(\\s+|^)"+b5+"(?:\\s+"+b5+")*(\\s+|$)","g");};r.InsertAt=function(b5,b6,b7){var b8;if(!(b7.parentNode===b5&&b6===(b8=b7.nextSibling,bN.Equals(b8,null)?null:b8)))b5.insertBefore(b7,b6);};r.RemoveNode=function(b5,b6){if(b6.parentNode===b5)b5.removeChild(b6);};s.$cctor=function(){var b5;s.$cctor=a.ignore;s.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");s.rtagName=new a.RegExp("<([\\w:]+)");s.rhtml=new a.RegExp("<|&#?\\w+;");s.wrapMap=(b5=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:b5,tbody:b5,tfoot:b5,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});s.defaultWrap=[0,"",""];};u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(b5,b6){return t.Look(bE.ofSeq(b6),b5);};t.Look=function(b5,b6){var b7,b8;switch(b6.$==2?(b7=b6.$0,0):b6.$==0?b5.$==1?(b7=[b5.$0,b5.$1,b6.$0],1):2:2){case 0:return{$:0,$0:b7,$1:b5};case 1:b8=bQ.TryFind(b7[0],b7[2]);return b8==null?u.NotFound:t.Look(b7[1],b8.$0);case 2:return u.NotFound;}};t.ToArray=function(b5){var b6;b6=[];t.Map(function(){return function(b7){return b6.push(b7);};},b5);return b6.slice(0);};t.Mapi=function(b5,b6){var b7;function b8(){var b9;b9=b7[0];b7[0]=b9+1;return b9;}b7=[0];return t.Map(function(b9){return b5(b8(),b9);},b6);};t.Map=function(b5,b6){return t.MapLoop(bE.T.Empty,b5,b6);};t.MapLoop=function(b5,b6,b7){return b7.$==1?{$:1}:b7.$==2?{$:2,$0:(b6(b5))(b7.$0)}:t.TrieBranch(bQ.Map(function(b8,b9){return t.MapLoop(bE.append(b5,bE.ofArray([b8])),b6,b9);},b7.$0));};t.Merge=function(b5){var b6,b7,b8;b6=d.ofSeqNonCopying(b5);b7=bF.length(b6);return b7===0?{$:1,$0:{$:1}}:b7===1?{$:1,$0:bF.get(b6,0)}:bF.exists(t.IsLeaf,b6)?null:(b8=t.MergeMaps(t.Merge,bL.choose(function(b9){return b9.$==0?{$:1,$0:b9.$0}:null;},b6)),b8==null?null:{$:1,$0:t.TrieBranch(b8.$0)});};t.IsLeaf=function(b5){return b5.$==2;};t.MergeMaps=function(b5,b6){var b7,b8;function b9(b_,b$){var ca;ca=b5(b$);return ca==null?null:{$:1,$0:[b_,ca.$0]};}b7=t.AllSome(bL.map(function(b_){return b9(b_[0],b_[1]);},bQ.ToSeq((b8=bL.collect(bQ.ToSeq,b6),bL.fold(function(b_,b$){return t.MultiAdd(b$[0],b$[1],b_);},new bR.New([]),b8)))));return b7==null?null:{$:1,$0:bQ.OfArray(bF.ofSeq(b7.$0))};};t.AllSome=function(b5){var b6,b7,b8,b9;b7=bG.Get(b5);b8=bM.MarkResizable([]);b6=true;while(b6&&b7.MoveNext()){b9=b7.Current();if(b9!=null&&b9.$==1)b8.push(b9.$0);else b6=false;}return b6?{$:1,$0:b8.slice()}:null;};t.MultiAdd=function(b5,b6,b7){return b7.Add$1(b5,new bE.T({$:1,$0:b6,$1:t.MultiFind(b5,b7)}));};t.MultiFind=function(b5,b6){var b7;b7=bQ.TryFind(b5,b6);return b7==null?bE.T.Empty:b7.$0;};t.Prefix=function(b5,b6){return t.TrieBranch(new bR.New(bE.ofArray([[b5,b6]])));};t.Leaf=function(b5){return{$:2,$0:b5};};t.TrieBranch=function(b5){return b5.get_IsEmpty()?{$:1}:{$:0,$0:b5};};v.$cctor=function(){v.$cctor=a.ignore;v.Empty={$:1};};w.Obsolete=function(b5){var b6,b7,b8,b9,b_;b7=b5.s;if(b7==null||(b7!=null&&b7.$==2?(b6=b7.$1,false):b7!=null&&b7.$==3?(b6=b7.$1,false):true))void 0;else{b5.s=null;for(b8=0,b9=bF.length(b6)-1;b8<=b9;b8++){b_=bF.get(b6,b8);if(typeof b_=="object")(function(b$){w.Obsolete(b$);}(b_));else b_();}}};w.New=function(b5){return{s:b5};};w.MapAsync=function(b5,b6){var b7;b7=w.New({$:3,$0:[],$1:[]});w.When(b6,function(b8){m.StartTo(b5(b8),function(b9){w.MarkDone(b7,b6,b9);});},b7);return b7;};w.SnapshotOn=function(b5,b6){var b7;function b8(b9){var b_,b$,ca;if(!(b_=b7.s,b_!=null&&b_.$==0||b_!=null&&b_.$==2)){b$=w.ValueAndForever(b5);ca=w.ValueAndForever(b6);if(b$!=null&&b$.$==1)ca!=null&&ca.$==1?b$.$0[1]||ca.$0[1]?w.MarkForever(b7,ca.$0[0]):w.MarkReady(b7,ca.$0[0]):void 0;}}b7=w.New({$:3,$0:[],$1:[]});w.When(b5,b8,b7);w.WhenReady(b6,b8);return b7;};w.Map3=function(b5,b6,b7,b8){var b9,b_,b$,ca;function cb(cc){var cd,ce,cf,cg;if(!(cd=ca.s,cd!=null&&cd.$==0||cd!=null&&cd.$==2)){ce=w.ValueAndForever(b6);cf=w.ValueAndForever(b7);cg=w.ValueAndForever(b8);if(ce!=null&&ce.$==1)cf!=null&&cf.$==1?cg!=null&&cg.$==1?ce.$0[1]&&cf.$0[1]&&cg.$0[1]?w.MarkForever(ca,b5(ce.$0[0],cf.$0[0],cg.$0[0])):w.MarkReady(ca,b5(ce.$0[0],cf.$0[0],cg.$0[0])):void 0:void 0;}}b9=b6.s;b_=b7.s;b$=b8.s;return b9!=null&&b9.$==0?b_!=null&&b_.$==0?b$!=null&&b$.$==0?w.New({$:0,$0:b5(b9.$0,b_.$0,b$.$0)}):w.Map3Opt1(b5,b9.$0,b_.$0,b8):b$!=null&&b$.$==0?w.Map3Opt2(b5,b9.$0,b$.$0,b7):w.Map3Opt3(b5,b9.$0,b7,b8):b_!=null&&b_.$==0?b$!=null&&b$.$==0?w.Map3Opt4(b5,b_.$0,b$.$0,b6):w.Map3Opt5(b5,b_.$0,b6,b8):b$!=null&&b$.$==0?w.Map3Opt6(b5,b$.$0,b6,b7):(ca=w.New({$:3,$0:[],$1:[]}),(w.When(b6,cb,ca),w.When(b7,cb,ca),w.When(b8,cb,ca),ca));};w.Map3Opt6=function(b5,b6,b7,b8){return w.Map2(function(b9,b_){return b5(b9,b_,b6);},b7,b8);};w.Map3Opt5=function(b5,b6,b7,b8){return w.Map2(function(b9,b_){return b5(b9,b6,b_);},b7,b8);};w.Map3Opt4=function(b5,b6,b7,b8){return w.Map(function(b9){return b5(b9,b6,b7);},b8);};w.Map3Opt3=function(b5,b6,b7,b8){return w.Map2(function(b9,b_){return b5(b6,b9,b_);},b7,b8);};w.Map3Opt2=function(b5,b6,b7,b8){return w.Map(function(b9){return b5(b6,b9,b7);},b8);};w.Map3Opt1=function(b5,b6,b7,b8){return w.Map(function(b9){return b5(b6,b7,b9);},b8);};w.Map2Unit=function(b5,b6){var b7,b8,b9;function b_(){var b$,ca,cb;if(!(b$=b9.s,b$!=null&&b$.$==0||b$!=null&&b$.$==2)){ca=w.ValueAndForever(b5);cb=w.ValueAndForever(b6);if(ca!=null&&ca.$==1)cb!=null&&cb.$==1?ca.$0[1]&&cb.$0[1]?w.MarkForever(b9,null):w.MarkReady(b9,null):void 0;}}b7=b5.s;b8=b6.s;return b7!=null&&b7.$==0?b8!=null&&b8.$==0?w.New({$:0,$0:null}):b6:b8!=null&&b8.$==0?b5:(b9=w.New({$:3,$0:[],$1:[]}),(w.When(b5,b_,b9),w.When(b6,b_,b9),b9));};w.Map2=function(b5,b6,b7){var b8,b9,b_;function b$(ca){var cb,cc,cd;if(!(cb=b_.s,cb!=null&&cb.$==0||cb!=null&&cb.$==2)){cc=w.ValueAndForever(b6);cd=w.ValueAndForever(b7);if(cc!=null&&cc.$==1)cd!=null&&cd.$==1?cc.$0[1]&&cd.$0[1]?w.MarkForever(b_,b5(cc.$0[0],cd.$0[0])):w.MarkReady(b_,b5(cc.$0[0],cd.$0[0])):void 0;}}b8=b6.s;b9=b7.s;return b8!=null&&b8.$==0?b9!=null&&b9.$==0?w.New({$:0,$0:b5(b8.$0,b9.$0)}):w.Map2Opt1(b5,b8.$0,b7):b9!=null&&b9.$==0?w.Map2Opt2(b5,b9.$0,b6):(b_=w.New({$:3,$0:[],$1:[]}),(w.When(b6,b$,b_),w.When(b7,b$,b_),b_));};w.Map2Opt2=function(b5,b6,b7){return w.Map(function(b8){return b5(b8,b6);},b7);};w.Map2Opt1=function(b5,b6,b7){return w.Map(function(b8){return b5(b6,b8);},b7);};w.MapCachedBy=function(b5,b6,b7,b8){return w.Map(function(b9){var b_,b$,ca;b_=b6[0];return b_!=null&&b_.$==1&&(b5(b9,b_.$0[0])&&(b$=[b_.$0[0],b_.$0[1]],true))?b$[1]:(ca=b7(b9),(b6[0]={$:1,$0:[b9,ca]},ca));},b8);};w.Copy=function(b5){var b6,b7,b8;b6=b5.s;return b6==null?b5:b6!=null&&b6.$==2?(b7=w.New({$:2,$0:b6.$0,$1:[]}),(w.WhenObsolete(b5,b7),b7)):b6!=null&&b6.$==3?(b8=w.New({$:3,$0:[],$1:[]}),(w.When(b5,function(b9){w.MarkDone(b8,b5,b9);},b8),b8)):b5;};w.WithInitOption=function(b5){var b6,b7,b8;b6=b5.s;return b6==null?w.New(null):b6!=null&&b6.$==2?(b7=w.New({$:2,$0:{$:1,$0:b6.$0},$1:[]}),(w.WhenObsolete(b5,b7),b7)):b6!=null&&b6.$==3?(b8=w.New({$:2,$0:null,$1:[]}),(w.When(b5,function(){w.Obsolete(b8);},b8),b8)):w.New({$:0,$0:{$:1,$0:b6.$0}});};w.WithInit=function(b5,b6){var b7,b8,b9;b7=b6.s;return b7==null?b6:b7!=null&&b7.$==2?(b8=w.New({$:2,$0:b7.$0,$1:[]}),(w.WhenObsolete(b6,b8),b8)):b7!=null&&b7.$==3?(b9=w.New({$:2,$0:b5,$1:[]}),(w.When(b6,function(){w.Obsolete(b9);},b9),b9)):b6;};w.Map=function(b5,b6){var b7,b8;b7=b6.s;return b7!=null&&b7.$==0?w.New({$:0,$0:b5(b7.$0)}):(b8=w.New({$:3,$0:[],$1:[]}),(w.When(b6,function(b9){w.MarkDone(b8,b6,b5(b9));},b8),b8));};w.Sequence=function(b5){var b6,b7,b8;function b9(b_){var b$;if(b8[0]===0){b$=bF.map(function(ca){var cb;cb=ca.s;return cb!=null&&cb.$==0?cb.$0:cb!=null&&cb.$==2?cb.$0:bS.FailWith("value not found by View.Sequence");},b6);if(bF.forall(function(ca){var cb;cb=ca.s;return cb!=null&&cb.$==0;},b6))w.MarkForever(b7,b$);else w.MarkReady(b7,b$);}else b8[0]=b8[0]-1;}b6=bF.ofSeq(b5);return b6.length==0?w.New({$:0,$0:[]}):(b7=w.New({$:3,$0:[],$1:[]}),(b8=[bF.length(b6)-1],(bF.iter(function(b_){w.When(b_,b9,b7);},b6),b7)));};w.CreateForeverAsync=function(b5){var b6;b6=w.New({$:3,$0:[],$1:[]});m.StartTo(b5,function(b7){w.MarkForever(b6,b7);});return b6;};w.JoinInner=function(b5){var b6;b6=w.New({$:3,$0:[],$1:[]});w.When(b5,function(b7){var b8;b8=b7();w.When(b8,function(b9){var b_,b$;if((b_=b8.s,b_!=null&&b_.$==0)&&(b$=b5.s,b$!=null&&b$.$==0))w.MarkForever(b6,b9);else w.MarkReady(b6,b9);},b6);w.WhenObsolete(b5,b8);},b6);return b6;};w.Join=function(b5){var b6;b6=w.New({$:3,$0:[],$1:[]});w.When(b5,function(b7){var b8;b8=b7();w.When(b8,function(b9){var b_,b$;if((b_=b8.s,b_!=null&&b_.$==0)&&(b$=b5.s,b$!=null&&b$.$==0))w.MarkForever(b6,b9);else w.MarkReady(b6,b9);},b6);},b6);return b6;};w.ValueAndForever=function(b5){var b6;b6=b5.s;return b6!=null&&b6.$==0?{$:1,$0:[b6.$0,true]}:b6!=null&&b6.$==2?{$:1,$0:[b6.$0,false]}:null;};w.WhenObsoleteRun=function(b5,b6){var b7;b7=b5.s;if(b7==null)b6();else b7!=null&&b7.$==2?b7.$1.push(b6):b7!=null&&b7.$==3?b7.$1.push(b6):void 0;};w.WhenObsolete=function(b5,b6){var b7;b7=b5.s;if(b7==null)w.Obsolete(b6);else b7!=null&&b7.$==2?w.EnqueueSafe(b7.$1,b6):b7!=null&&b7.$==3?w.EnqueueSafe(b7.$1,b6):void 0;};w.WhenReady=function(b5,b6){var b7,b8;b8=b5.s;switch(b8!=null&&b8.$==2?(b7=b8.$0,0):b8==null?1:b8!=null&&b8.$==3?2:(b7=b8.$0,0)){case 0:b6(b7);break;case 1:null;break;case 2:b8.$0.push(b6);break;}};w.WhenRun=function(b5,b6,b7){var b8;b8=b5.s;if(b8==null)b7();else b8!=null&&b8.$==2?(b8.$1.push(b7),b6(b8.$0)):b8!=null&&b8.$==3?(b8.$0.push(b6),b8.$1.push(b7)):b6(b8.$0);};w.When=function(b5,b6,b7){var b8;b8=b5.s;if(b8==null)w.Obsolete(b7);else b8!=null&&b8.$==2?(w.EnqueueSafe(b8.$1,b7),b6(b8.$0)):b8!=null&&b8.$==3?(b8.$0.push(b6),w.EnqueueSafe(b8.$1,b7)):b6(b8.$0);};w.EnqueueSafe=function(b5,b6){var b7,b8,b9,b_;b5.push(b6);if(b5.length%20===0){b7=b5.slice(0);bT.Clear(b5);for(b8=0,b9=bF.length(b7)-1;b8<=b9;b8++){b_=bF.get(b7,b8);if(typeof b_=="object")(function(b$){if(b$.s)b5.push(b$);}(b_));else(function(b$){b5.push(b$);}(b_));}}else void 0;};w.MarkDone=function(b5,b6,b7){var b8;if(b8=b6.s,b8!=null&&b8.$==0)w.MarkForever(b5,b7);else w.MarkReady(b5,b7);};w.MarkReady=function(b5,b6){var b7,b8,b9,b_;b7=b5.s;if(b7!=null&&b7.$==3){b5.s={$:2,$0:b6,$1:b7.$1};b8=b7.$0;for(b9=0,b_=bF.length(b8)-1;b9<=b_;b9++)(bF.get(b8,b9))(b6);}else void 0;};w.MarkForever=function(b5,b6){var b7,b8,b9,b_;b7=b5.s;if(b7!=null&&b7.$==3){b5.s={$:0,$0:b6};b8=b7.$0;for(b9=0,b_=bF.length(b8)-1;b9<=b_;b9++)(bF.get(b8,b9))(b6);}else void 0;};w.TryGet=function(b5){var b6,b7;b6=b5.s;return(b6!=null&&b6.$==0?(b7=b6.$0,true):b6!=null&&b6.$==2&&(b7=b6.$0,true))?{$:1,$0:b7}:null;};x=c.Var=bM.Class({},k,x);x.New=bM.Ctor(function(){k.New.call(this);},x);y=c.View=bM.Class({get_V:function(){return bS.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.");}},null,y);z=c.ConcreteVar=bM.Class({get_Id:function(){return"uinref"+a.String(this.id);},get_View:function(){return this.view;},UpdateMaybe:function(b5){var b6;b6=b5(this.Get());if(b6!=null&&b6.$==1)this.Set(b6.$0);},Update:function(b5){this.Set(b5(this.Get()));},SetFinal:function(b5){if(this.isConst)(function(b6){return b6("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b6){bO.log(b6);}));else{w.Obsolete(this.snap);this.isConst=true;this.current=b5;this.snap=w.New({$:0,$0:b5});}},Set:function(b5){if(this.isConst)(function(b6){return b6("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b6){bO.log(b6);}));else{w.Obsolete(this.snap);this.current=b5;this.snap=w.New({$:2,$0:b5,$1:[]});}},Get:function(){return this.current;}},x,z);z.New=bM.Ctor(function(b5,b6,b7){var b8;b8=this;x.New.call(this);this.isConst=b5;this.current=b7;this.snap=b6;this.view=function(){return b8.snap;};this.id=h.Int();},z);A=c.Var$1=bM.Class({},k,A);A.MapLens=function(b5,b6,b7){return y.MapSeqCachedViewBy(b5,function(b8,b9){var b_,b$;function ca(cb){return bN.Equals(b5(cb),b8);}b_=h.Id();return b6((b$=new x({Get:function(){return bL.find(ca,b7.Get());},Set:function(cb){function cc(cd){return cb;}return b7.Update(function(cd){return f.replaceFirst(ca,cc,cd);});},SetFinal:function(cb){return this.Set(cb);},Update:function(cb){return b7.Update(function(cc){return f.replaceFirst(ca,cb,cc);});},UpdateMaybe:function(cb){return b7.Update(function(cc){return f.maybeReplaceFirst(ca,cb,cc);});},get_View:function(){return b9;},get_Id:function(){return b_;}}),(x.New.call(b$),b$)));},b7.get_View());};A.Lens=function(b5,b6,b7){var b8,b9,b_;b8=h.Id();b9=y.Map(b6,b5.get_View());b_=new x({Get:function(){return b6(b5.Get());},Set:function(b$){return b5.Update(function(ca){return b7(ca,b$);});},SetFinal:function(b$){return this.Set(b$);},Update:function(b$){return b5.Update(function(ca){return b7(ca,b$(b6(ca)));});},UpdateMaybe:function(b$){return b5.UpdateMaybe(function(ca){var cb;cb=b$(b6(ca));return cb==null?null:{$:1,$0:b7(ca,cb.$0)};});},get_View:function(){return b9;},get_Id:function(){return b8;}});x.New.call(b_);return b_;};A.Update=function(b5,b6){A.Set(b5,b6(b5.Get()));};A.SetFinal=function(b5,b6){b5.SetFinal(b6);};A.Set=function(b5,b6){b5.Set(b6);};A.CreateWaiting=function(){return new z.New(false,w.New({$:3,$0:[],$1:[]}),null);};A.Create=function(){return new z.New(false,w.New({$:2,$0:null,$1:[]}),null);};A.CreateLogged=function(b5,b6){var b7;if(!self.UINVars)self.UINVars=[];b7=A.Create$1(b6);self.UINVars.push([b5,b7]);return b7;};A.Create$1=function(b5){return new z.New(false,w.New({$:2,$0:b5,$1:[]}),b5);};A.New=bM.Ctor(function(){k.New.call(this);},A);B=c.Updates=bM.Class({set_Value:function(b5){var b6;b6=this.s;if(!(b6===null))w.Obsolete(b6);this.c=b5;}},null,B);B.Create=function(b5){var b6;b6=null;b6=B.New(b5,null,function(){var b7;b7=b6.s;return b7===null?(b7=w.Copy(b6.c()),b6.s=b7,w.WhenObsoleteRun(b7,function(){b6.s=null;}),b7):b7;});return b6;};B.New=function(b5,b6,b7){return new B({c:b5,s:b6,v:b7});};y.get_Do=function(){return D.B;};y.Apply=function(b5,b6){return y.Map2(function(b7,b8){return b7(b8);},b5,b6);};y.AsyncAwait=function(b5,b6){function b7(b8){var b9,b_;function b$(){return y.RemovableSink(function(ca){if(b5(ca)){(bU.Force(b9))();b8(ca);}},b6);}b9=bU.Create(b$);b_=bU.Force(b9);}return bP.FromContinuations(function(b8,b9,b_){return b7.apply(null,[b8,b9,b_]);});};y.RemovableSink=function(b5,b6){var b7;function b8(){w.WhenRun(b6(),function(b9){if(b7[0])b5(b9);},function(){if(b7[0])bP.scheduler().Fork(b8);});}b7=[true];bP.scheduler().Fork(b8);return function(){b7[0]=false;};};y.Sink=function(b5,b6){function b7(){w.WhenRun(b6(),b5,function(){bP.scheduler().Fork(b7);});}bP.scheduler().Fork(b7);};y.TryFinally=function(b5,b6){return y.CreateLazy(function(){try{return b6();}finally{b5();}});};y.TryWith=function(b5,b6){return y.CreateLazy(function(){try{return b6();}catch(b7){return(b5(b7))();}});};y.ConstAsync=function(b5){var b6;b6=w.CreateForeverAsync(b5);return function(){return b6;};};y.Const=function(b5){var b6;b6=w.New({$:0,$0:b5});return function(){return b6;};};y.Sequence=function(b5){return y.CreateLazy(function(){return w.Sequence(bL.map(function(b6){return b6();},b5));});};y.UpdateWhile=function(b5,b6,b7){var b8;b8=[b5];return y.BindInner(function(b9){return b9?y.Map(function(b_){b8[0]=b_;return b_;},b7):y.Const(b8[0]);},b6);};y.BindInner=function(b5,b6){return y.JoinInner(y.Map(b5,b6));};y.JoinInner=function(b5){return y.CreateLazy(function(){return w.JoinInner(b5());});};y.Bind=function(b5,b6){return y.Join(y.Map(b5,b6));};y.Join=function(b5){return y.CreateLazy(function(){return w.Join(b5());});};y.MapSeqCachedView=function(b5,b6){function b7(b8){return b5;}return y.MapSeqCachedViewBy(a.id,function(b8,b9){return(b7(b8))(b9);},b6);};y.MapSeqCachedViewBy=function(b5,b6,b7){var b8;b8=[new bV.New$5()];return y.Map(function(b9){var b_,b$,ca;b_=b8[0];b$=new bV.New$5();ca=d.mapInPlace(function(cb){var cc,cd,ce;cc=b5(cb);cd=b_.ContainsKey(cc)?(ce=b_.Item(cc),(A.Set(ce.r,cb),ce)):y.ConvertSeqNode(function(cf){return b6(cc,cf);},cb);b$.set_Item(cc,cd);return cd.e;},bF.ofSeq(b9));b8[0]=b$;return ca;},b7);};y.ConvertSeqNode=function(b5,b6){var b7,b8;b7=A.Create$1(b6);b8=b7.get_View();return{e:b5(b8),r:b7,w:b8};};y.MapSeqCached=function(b5,b6){return y.MapSeqCachedBy(a.id,b5,b6);};y.MapSeqCachedBy=function(b5,b6,b7){var b8;b8=[new bV.New$5()];return y.Map(function(b9){var b_,b$,ca;b_=b8[0];b$=new bV.New$5();ca=d.mapInPlace(function(cb){var cc,cd;cc=b5(cb);cd=b_.ContainsKey(cc)?b_.Item(cc):b6(cb);b$.set_Item(cc,cd);return cd;},bF.ofSeq(b9));b8[0]=b$;return ca;},b7);};y.SnapshotOn=function(b5,b6,b7){var b8;b8=w.New({$:2,$0:b5,$1:[]});return y.CreateLazy(function(){return b8.s==null?w.SnapshotOn(b6(),b7()):(w.WhenObsolete(b6(),b8),b8);});};y.GetAsync=function(b5){return bP.FromContinuations(function(b6){return y.Get(b6,b5);});};y.WithInitOption=function(b5){return y.CreateLazy(function(){return w.WithInitOption(b5());});};y.WithInit=function(b5,b6){return y.CreateLazy(function(){return w.WithInit(b5,b6());});};y.Get=function(b5,b6){var b7;function b8(){w.WhenRun(b6(),function(b9){if(!b7[0]){b7[0]=true;b5(b9);}},function(){if(!b7[0])b8();});}b7=[false];b8();};y.TryGet=function(b5){return w.TryGet(b5());};y.MapAsync2=function(b5,b6,b7){return y.MapAsync(a.id,y.Map2(b5,b6,b7));};y.MapAsync=function(b5,b6){return y.CreateLazy(function(){return w.MapAsync(b5,b6());});};y.Map3=function(b5,b6,b7,b8){return y.CreateLazy(function(){return w.Map3(b5,b6(),b7(),b8());});};y.Map2Unit=function(b5,b6){return y.CreateLazy(function(){return w.Map2Unit(b5(),b6());});};y.Map2=function(b5,b6,b7){return y.CreateLazy(function(){return w.Map2(b5,b6(),b7());});};y.MapCached=function(b5,b6){return y.MapCachedBy(bN.Equals,b5,b6);};y.MapCachedBy=function(b5,b6,b7){var b8;b8=[null];return y.CreateLazy(function(){return w.MapCachedBy(b5,b8,b6,b7());});};y.Map=function(b5,b6){return y.CreateLazy(function(){return w.Map(b5,b6());});};y.CreateLazy=function(b5){var b6;b6={c:null,o:b5};return function(){var b7,b8;b7=b6.c;return b7===null?(b7=b6.o(),b6.c=b7,(b8=b7.s,b8!=null&&b8.$==0)?b6.o=null:w.WhenObsoleteRun(b7,function(){b6.c=null;}),b7):b7;};};C=c.FromView=bM.Class({get_Id:function(){return"uinref"+a.String(this.id);},SetFinal:function(b5){this.set(b5);},Update:function(b5){var b6;y.Get((b6=this.set,function(b7){return b6(b5(b7));}),this.view);},UpdateMaybe:function(b5){var b6;b6=this;y.Get(function(b7){var b8;b8=b5(b7);if(b8!=null&&b8.$==1)b6.set(b8.$0);},this.view);},Set:function(b5){this.set(b5);},Get:function(){return this.current;},get_View:function(){return this.view;}},x,C);C.New=bM.Ctor(function(b5,b6){var b7,b8;b7=this;x.New.call(this);this.set=b6;this.id=h.Int();this.current=(b8=y.TryGet(b5),b8==null?null:b8.$0);this.view=y.Map(function(b9){b7.current=b9;return b9;},b5);},C);D.B={$:0};E=c.Submitter=bM.Class({Trigger:function(){this["var"].Set(null);}},k,E);E.New=bM.Ctor(function(b5,b6){k.New.call(this);this.input=b5;this["var"]=A.Create();this.view=y.SnapshotOn(b6,this["var"].get_View(),this.input);},E);E.CreateOption=function(b5){return new E.New(y.Map(function(b6){return{$:1,$0:b6};},b5),null);};F.Fresh=function(){return{$:0,$0:h.Int()};};G=c.Model=bM.Class({},k,G);G.New=bM.Ctor(function(b5,b6){var b7;b7=A.Create$1(b6);G.New$1.call(this,b7,y.Map(b5,b7.get_View()));},G);G.New$1=bM.Ctor(function(b5,b6){k.New.call(this);this["var"]=b5;this.view=b6;},G);G.Update=function(b5,b6){A.Update(b6["var"],function(b7){b5(b7);return b7;});};G.Create=function(b5,b6){return new G.New(b5,b6);};H.Default=function(){N.$cctor();return N.Default;};J=I.ArrayStorage=bM.Class({SSet:function(b5){return bF.ofSeq(b5);},SSetAt:function(b5,b6,b7){bF.set(b7,b5,b6);return b7;},SRemoveIf:function(b5,b6){return bF.filter(function(b7){return!b5(b7);},b6);},SInit:function(){return this.init;},SPrependMany:function(b5,b6){var b7;b7=d.ofSeqNonCopying(b5);b6.unshift.apply(b6,b7);return b6;},SPrepend:function(b5,b6){b6.unshift(b5);return b6;},SAppendMany:function(b5,b6){var b7;b7=d.ofSeqNonCopying(b5);b6.push.apply(b6,b7);return b6;},SAppend:function(b5,b6){b6.push(b5);return b6;}},k,J);J.New=bM.Ctor(function(b5){k.New.call(this);this.init=b5;},J);K=I.LocalStorageBackend=bM.Class({clear:function(){this.storage.removeItem(this.id);},set:function(b5){this.storage.setItem(this.id,bW.stringify(bF.map(this.serializer.Encode,b5)));return b5;},SSet:function(b5){return this.set(bF.ofSeq(b5));},SSetAt:function(b5,b6,b7){bF.set(b7,b5,b6);return this.set(b7);},SRemoveIf:function(b5,b6){return this.set(bF.filter(function(b7){return!b5(b7);},b6));},SInit:function(){var b5;b5=this.storage.getItem(this.id);if(b5===null)return[];else try{return bF.map(this.serializer.Decode,bW.parse(b5));}catch(b6){return[];}},SPrependMany:function(b5,b6){var b7;b7=d.ofSeqNonCopying(b5);b6.unshift.apply(b6,b7);return this.set(b6);},SPrepend:function(b5,b6){b6.unshift(b5);return this.set(b6);},SAppendMany:function(b5,b6){var b7;b7=d.ofSeqNonCopying(b5);b6.push.apply(b6,b7);return this.set(b6);},SAppend:function(b5,b6){b6.push(b5);return this.set(b6);}},k,K);K.New=bM.Ctor(function(b5,b6){k.New.call(this);this.id=b5;this.serializer=b6;this.storage=self.localStorage;},K);I.LocalStorage=function(b5,b6){return new K.New(b5,b6);};I.InMemory=function(b5){return new J.New(b5);};L=c.ListModel=bM.Class({Wrap:function(b5,b6,b7){return L.Wrap(this,b5,b6,b7);},MapLens:function(b5){var b6;b6=this;return y.MapSeqCachedViewBy(b6.key,function(b7,b8){return b5(b7,b6["LensInto'"](a.id,function(b9,b_){return b_;},b7,b8));},this["var"].get_View());},Lens:function(b5){return this.LensInto(a.id,function(b6,b7){return b7;},b5);},LensInto:function(b5,b6,b7){return this["LensInto'"](b5,b6,b7,y.Map(b5,this.FindByKeyAsView(b7)));},"LensInto'":function(b5,b6,b7,b8){var b9,b_,b$;b9=this;b_=h.Id();b$=new x({Get:function(){return b5(b9.FindByKey(b7));},Set:function(ca){return b9.UpdateBy(function(cb){return{$:1,$0:b6(cb,ca)};},b7);},SetFinal:function(ca){return this.Set(ca);},Update:function(ca){return b9.UpdateBy(function(cb){return{$:1,$0:b6(cb,ca(b5(cb)))};},b7);},UpdateMaybe:function(ca){return b9.UpdateBy(function(cb){var cc;cc=ca(b5(cb));return cc==null?null:{$:1,$0:b6(cb,cc.$0)};},b7);},get_View:function(){return b8;},get_Id:function(){return b_;}});x.New.call(b$);return b$;},get_LengthAsView:function(){return y.Map(bF.length,this["var"].get_View());},get_Length:function(){return bF.length(this["var"].Get());},Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(b5,b6){var b7,b8,b9,b_,b$;b7=this;b8=this["var"].Get();b9=bF.tryFindIndex(function(ca){return bN.Equals(b7.key(ca),b6);},b8);if(b9!=null&&b9.$==1){b_=b9.$0;b$=b5(bF.get(b8,b_));b$!=null&&b$.$==1?(this["var"].Set(this.storage.SSetAt(b_,b$.$0,b8)),this.ObsoleteKey(b6)):void 0;}},UpdateAll:function(b5){var b6;b6=this;this["var"].Update(function(b7){bF.iteri(function(b8,b9){var b_;b_=b5(b9);return b_==null?null:bF.set(b7,b8,b_.$0);},b7);return b6.storage.SSet(b7);});this.ObsoleteAll();},FindByKeyAsView:function(b5){return y.Map(function(b6){return b6.$0;},this.TryFindByKeyAsView(b5));},TryFindByKeyAsView:function(b5){var b6;b6=this;return function(){var b7,b8,b9;b7=(b8=null,[b6.it.TryGetValue(b5,{get:function(){return b8;},set:function(b_){b8=b_;}}),b8]);return b7[0]?b7[1]:(b9=w.New({$:2,$0:b6.TryFindByKey(b5),$1:[]}),(b6.it.DAdd(b5,b9),b9));};},TryFindByKey:function(b5){var b6;b6=this;return bF.tryFind(function(b7){return bN.Equals(b6.key(b7),b5);},this["var"].Get());},FindByKey:function(b5){var b6;b6=this;return bF.find(function(b7){return bN.Equals(b6.key(b7),b5);},this["var"].Get());},TryFindAsView:function(b5){return y.Map(function(b6){return bF.tryFind(b5,b6);},this["var"].get_View());},FindAsView:function(b5){return y.Map(function(b6){return bF.find(b5,b6);},this["var"].get_View());},TryFind:function(b5){return bF.tryFind(b5,this["var"].Get());},Find:function(b5){return bF.find(b5,this["var"].Get());},ContainsKeyAsView:function(b5){var b6;function b7(b8){return bN.Equals(b6.key(b8),b5);}b6=this;return y.Map(function(b8){return bF.exists(b7,b8);},this["var"].get_View());},ContainsKey:function(b5){var b6;b6=this;return bF.exists(function(b7){return bN.Equals(b6.key(b7),b5);},this["var"].Get());},Set:function(b5){this["var"].Set(this.storage.SSet(b5));this.ObsoleteAll();},Iter:function(b5){bF.iter(b5,this["var"].Get());},RemoveByKey:function(b5){var b6;b6=this;this["var"].Set(this.storage.SRemoveIf(function(b7){return bN.Equals(b6.key(b7),b5);},this["var"].Get()));this.ObsoleteKey(b5);},RemoveBy:function(b5){var b6,b7,b8,b9;b6=this["var"].Get();for(b7=0,b8=b6.length-1;b7<=b8;b7++){b9=bF.get(b6,b7);if(b5(b9))this.ObsoleteKey(this.key(b9));}this["var"].Set(this.storage.SRemoveIf(b5,this["var"].Get()));},Remove:function(b5){var b6,b7,b8,b9;b6=this;b7=this["var"].Get();if(M.Contains(b6.key,b5,b7)){b8=b6.key;b9=b8(b5);this["var"].Set(this.storage.SRemoveIf(function(b_){return bN.Equals(b8(b_),b9);},b7));this.ObsoleteKey(b9);}},PrependMany:function(b5){var b6,b7;function b8(b9,b_){var b$,ca;b$=b6.key(b_);b6.ObsoleteKey(b$);ca=bF.tryFindIndex(function(cb){return bN.Equals(b6.key(cb),b$);},b9);return ca==null?(b7.push(b_),b9):b6.storage.SSetAt(ca.$0,b_,b9);}b6=this;b7=bM.MarkResizable([]);this["var"].Set(this.storage.SPrependMany(b7,(((bM.Curried3(bL.fold))(b8))(this["var"].Get()))(b5)));},Prepend:function(b5){var b6,b7,b8,b9;b6=this;b7=this["var"].Get();b8=this.key(b5);b9=bF.tryFindIndex(function(b_){return bN.Equals(b6.key(b_),b8);},b7);if(b9!=null&&b9.$==1)this["var"].Set(this.storage.SSetAt(b9.$0,b5,b7));else this["var"].Set(this.storage.SPrepend(b5,b7));this.ObsoleteKey(b8);},AppendMany:function(b5){var b6,b7;function b8(b9,b_){var b$,ca;b$=b6.key(b_);b6.ObsoleteKey(b$);ca=bF.tryFindIndex(function(cb){return bN.Equals(b6.key(cb),b$);},b9);return ca==null?(b7.push(b_),b9):b6.storage.SSetAt(ca.$0,b_,b9);}b6=this;b7=bM.MarkResizable([]);this["var"].Set(this.storage.SAppendMany(b7,(((bM.Curried3(bL.fold))(b8))(this["var"].Get()))(b5)));},Append:function(b5){var b6,b7,b8,b9;b6=this;b7=this["var"].Get();b8=this.key(b5);b9=bF.tryFindIndex(function(b_){return bN.Equals(b6.key(b_),b8);},b7);if(b9!=null&&b9.$==1)this["var"].Set(this.storage.SSetAt(b9.$0,b5,b7));else this["var"].Set(this.storage.SAppend(b5,b7));this.ObsoleteKey(b8);},ObsoleteAll:function(){bL.iter(function(b5){w.Obsolete(b5.V);},this.it);this.it.Clear();},ObsoleteKey:function(b5){var b6,b7;b6=(b7=null,[this.it.TryGetValue(b5,{get:function(){return b7;},set:function(b8){b7=b8;}}),b7]);if(b6[0]){w.Obsolete(b6[1]);this.it.RemoveKey(b5);}},GetEnumerator0:function(){return bG.Get0(this["var"].Get());},GetEnumerator:function(){return bG.Get(this["var"].Get());}},k,L);L.New=bM.Ctor(function(b5,b6){L.New$3.call(this,b5,A.Create$1(bF.ofSeq(bL.distinctBy(b5,b6.SInit()))),b6);},L);L.New$1=bM.Ctor(function(b5){L.New$2.call(this,b5,[]);},L);L.New$2=bM.Ctor(function(b5,b6){var b7;b7=bF.ofSeq(b6);L.New$3.call(this,b5,A.Create$1(b7),I.InMemory(b7));},L);L.New$3=bM.Ctor(function(b5,b6,b7){k.New.call(this);this.key=b5;this["var"]=b6;this.storage=b7;this.v=y.Map(function(b8){return b8.slice();},this["var"].get_View());this.it=new bV.New$5();},L);M.Contains=function(b5,b6,b7){var b8;b8=b5(b6);return bF.exists(function(b9){return bN.Equals(b5(b9),b8);},b7);};L.Wrap=function(b5,b6,b7,b8){var b9,b_;b9=[new bV.New$5()];b_=bF.map(function(b$){var ca;ca=b7(b$);b9[0].set_Item(b5.key(b$),ca);return ca;},b5["var"].Get());return new L.New$3(function(b$){return b5.key(b6(b$));},A.Lens(b5["var"],function(b$){var ca,cb;ca=new bV.New$5();cb=bF.map(function(cc){var cd,ce;cd=b5.key(cc);ce=b9[0].ContainsKey(cd)?b8(b9[0].Item(cd),cc):b7(cc);ca.set_Item(cd,ce);return ce;},b$);b9[0]=ca;return cb;},function(b$,ca){var cb,cc;cb=new bV.New$5();cc=bF.map(function(cd){var ce;ce=b6(cd);cb.set_Item(b5.key(ce),cd);return ce;},ca);b9[0]=cb;return cc;}),I.InMemory(b_));};L.FromSeq=function(b5){return L.Create(a.id,b5);};L.Create=function(b5,b6){return L.CreateWithStorage(b5,I.InMemory(bF.ofSeq(b6)));};L.CreateWithStorage=function(b5,b6){return new L.New(b5,b6);};N.$cctor=function(){N.$cctor=a.ignore;N.Default={Encode:a.id,Decode:a.id};};O=c.ReactiveExtensions=bM.Class({},k,O);O.New=bM.Ctor(function(){k.New.call(this);},O);P=c.DoubleInterpolation=bM.Class({Interpolate:function(b5,b6,b7){return b6+b5*(b7-b6);}},null,P);P.DoubleInterpolation=new P({$:0});Q.get_Double=function(){return P.DoubleInterpolation;};R=c.Easing=bM.Class({TransformTime:function(b5){return this.transformTime(b5);}},k,R);R.get_CubicInOut=function(){return S.CubicInOut();};R.Custom=function(b5){return new R.New(b5);};R.New=bM.Ctor(function(b5){k.New.call(this);this.transformTime=b5;},R);S.CubicInOut=function(){W.$cctor();return W.CubicInOut;};T.get_Empty=function(){return{$:0,$0:p.Empty()};};T.WhenDone=function(b5,b6){return T.Append({$:0,$0:p.Single({$:0,$0:b5})},b6);};T.Run=function(b5,b6){var b7;function b8(b9){function b_(b$){return function(ca){var cb;cb=ca-b$;b6.Compute(cb);b5();return cb<=b7?void a.requestAnimationFrame(function(cc){(b_(b$))(cc);}):b9();};}a.requestAnimationFrame(function(b$){(b_(b$))(b$);});}b7=b6.Duration;return b7===0?bP.Zero():bP.FromContinuations(function(b9,b_,b$){return b8.apply(null,[b9,b_,b$]);});};T.Play=function(b5){var b6;b6=null;return bP.Delay(function(){return bP.Bind(T.Run(a.ignore,U.Actions(b5)),function(){U.Finalize(b5);return bP.Return(null);});});};T.Pack=function(b5){return{$:0,$0:p.Single({$:1,$0:b5})};};T.Map=function(b5,b6){var b7;return U.Def(b6.Duration,(b7=b6.Compute,function(b8){return b5(b7(b8));}));};T.Delayed=function(b5,b6,b7,b8,b9,b_){return{Compute:function(b$){return b$<=b8?b9:b5.Interpolate(b6.TransformTime((b$-b8)/b7),b9,b_);},Duration:b7+b8};};T.Simple=function(b5,b6,b7,b8,b9){return{Compute:function(b_){return b5.Interpolate(b6.TransformTime(b_/b7),b8,b9);},Duration:b7};};T.Const=function(b5){return U.Const(b5);};T.Concat=function(b5){return{$:0,$0:p.Concat(bL.map(U.List,b5))};};T.Append=function(b5,b6){return{$:0,$0:p.Append(b5.$0,b6.$0)};};T.set_UseAnimations=function(b5){U.set_UseAnimations(b5);};T.get_UseAnimations=function(){return U.UseAnimations();};U.UseAnimations=function(){W.$cctor();return W.UseAnimations;};U.set_UseAnimations=function(b5){W.$cctor();W.UseAnimations=b5;};U.Actions=function(b5){return U.ConcatActions(bF.choose(function(b6){return b6.$==1?{$:1,$0:b6.$0}:null;},p.ToArray(b5.$0)));};U.ConcatActions=function(b5){var b6,b7,b8,b9;b6=d.ofSeqNonCopying(b5);b7=bF.length(b6);return b7===0?U.Const():b7===1?bF.get(b6,0):(b8=bL.max(bL.map(function(b_){return b_.Duration;},b6)),(b9=bF.map(function(b_){return U.Prolong(b8,b_);},b6),U.Def(b8,function(b_){bF.iter(function(b$){b$.Compute(b_);},b9);})));};U.Prolong=function(b5,b6){var b7,b8,b9;b7=b6.Compute;b8=b6.Duration;b9=bU.Create(function(){return b6.Compute(b6.Duration);});return{Compute:function(b_){return b_>=b8?b9.f():b7(b_);},Duration:b5};};U.Const=function(b5){return U.Def(0,function(){return b5;});};U.Def=function(b5,b6){return{Compute:b6,Duration:b5};};U.Finalize=function(b5){bF.iter(function(b6){if(b6.$==0)b6.$0();},p.ToArray(b5.$0));};U.List=function(b5){return b5.$0;};V=c.Trans=bM.Class({Copy:function(b5,b6,b7,b8){var b9,b_,b$,ca,cb;function cc(cd,ce){return b9.TChange(cd,ce);}b9=this;b_=b5==null?function(cd){return function(ce){return cc(cd,ce);};}:b5.$0;return new V.New$3(function(cd,ce){return(b_(cd))(ce);},(b$=this.get_TEnter(),b6==null?b$:b6.$0),(ca=this.get_TExit(),b7==null?ca:b7.$0),(cb=this.get_TFlags(),b8==null?cb:b8.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(b5,b6){return this.change(b5,b6);}},k,V);V.New=bM.Ctor(function(b5,b6,b7){V.New$3.call(this,b5,bN.Equals(b6,null)?T.Const:b6,bN.Equals(b7,null)?T.Const:b7,1|(bN.Equals(b6,null)?0:2)|(bN.Equals(b7,null)?0:4));},V);V.New$1=bM.Ctor(function(b5){V.New$3.call(this,b5,T.Const,T.Const,1);},V);V.New$2=bM.Ctor(function(){V.New$3.call(this,function(b5,b6){return T.Const(b6);},T.Const,T.Const,0);},V);V.New$3=bM.Ctor(function(b5,b6,b7,b8){k.New.call(this);this.change=b5;this.enter=b6;this.exit=b7;this.flags=b8;},V);V.Exit=function(b5,b6){return b6.Copy(null,null,{$:1,$0:b5},{$:1,$0:b6.get_TFlags()|4});};V.Enter=function(b5,b6){return b6.Copy(null,{$:1,$0:b5},null,{$:1,$0:b6.get_TFlags()|2});};V.Change=function(b5,b6){return b6.Copy({$:1,$0:b5},null,null,{$:1,$0:b6.get_TFlags()|1});};V.Create=function(b5){return new V.New$1(b5);};V.Trivial=function(){return new V.New$2();};V.CanAnimateExit=function(b5){var b6,b7;b6=b5.get_TFlags();b7=4;return(b6&b7)===b7;};V.CanAnimateEnter=function(b5){var b6,b7;b6=b5.get_TFlags();b7=2;return(b6&b7)===b7;};V.CanAnimateChange=function(b5){var b6,b7;b6=b5.get_TFlags();b7=1;return(b6&b7)===b7;};V.AnimateExit=function(b5,b6){return(b5.get_TExit())(b6);};V.AnimateEnter=function(b5,b6){return(b5.get_TEnter())(b6);};V.AnimateChange=function(b5,b6,b7){return b5.TChange(b6,b7);};W.$cctor=function(){W.$cctor=a.ignore;W.CubicInOut=R.Custom(function(b5){var b6;b6=b5*b5;return 3*b6-2*(b6*b5);});W.UseAnimations=true;};Z=c.OnAfterRenderControl=bM.Class({get_Body:function(){var b5,b6,b7,b8,b9,b_,b$;b6=self.document.querySelectorAll("[ws-runafterrender]");for(b7=0,b8=b6.length-1;b7<=b8;b7++){b9=b6[b7];b_=b9.getAttribute("ws-runafterrender");if(b_.indexOf("AfterRenderQ2Client")!=-1){b9.removeAttribute("ws-runafterrender");a["eval"](b_);}else{b$=a["eval"](b_);b9.removeAttribute("ws-runafterrender");b$(b9);}}b5={ReplaceInDom:function(){return null;}};k.New.call(b5);return b5;}},Y,Z);_0=c.AnimatedAttrNode=bM.Class({sync:function(b5){var b6;if(this.dirty){b6=this.logical;if(b6==null);else(this.push(b5))(b6.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(b5,b6){this.visible={$:1,$0:b6};this.dirty=true;(this.push(b5))(b6);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(b5){var b6,b7;b6=this;return T.WhenDone(function(){b6.dirty=true;b6.visible=null;},(b7=this.visible,b7!=null&&b7.$==1?T.Pack(T.Map(function(b8){b6.pushVisible(b5,b8);},V.AnimateExit(this.tr,b7.$0))):T.get_Empty()));},NGetEnterAnim:function(b5){var b6,b7,b8,b9,b_;b8=this;b9=this.visible;b_=this.logical;switch(b9==null?b_!=null&&b_.$==1?(b7=b_.$0,1):2:b_!=null&&b_.$==1?this.dirty?(b7=[b_.$0,b9.$0],0):2:2){case 0:b6=T.Pack(T.Map(function(b$){b8.pushVisible(b5,b$);},V.AnimateChange(this.tr,b7[1],b7[0])));break;case 1:b6=T.Pack(T.Map(function(b$){b8.pushVisible(b5,b$);},V.AnimateEnter(this.tr,b7)));break;case 2:b6=T.get_Empty();break;}return T.WhenDone(function(){b8.sync(b5);},b6);},NGetChangeAnim:function(b5){var b6,b7,b8,b9;b6=this;return T.WhenDone(function(){b6.sync(b5);},(b7=this.visible,(b8=this.logical,b7!=null&&b7.$==1&&(b8!=null&&b8.$==1&&(this.dirty&&(b9=[b8.$0,b7.$0],true)))?T.Pack(T.Map(function(b_){b6.pushVisible(b5,b_);},V.AnimateChange(this.tr,b9[1],b9[0]))):T.get_Empty())));}},k,_0);_0.New=bM.Ctor(function(b5,b6,b7){var b8;b8=this;k.New.call(this);this.tr=b5;this.push=b7;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(b9){b8.logical={$:1,$0:b9};b8.dirty=true;},b6);},_0);_1=c.DynamicAttrNode=bM.Class({NChanged:function(){return this.updates;},NSync:function(b5){if(this.dirty){(this.push(b5))(this.value);this.dirty=false;}},NGetExitAnim:function(b5){return T.get_Empty();},NGetEnterAnim:function(b5){return T.get_Empty();},NGetChangeAnim:function(b5){return T.get_Empty();}},k,_1);_1.New=bM.Ctor(function(b5,b6){var b7;b7=this;k.New.call(this);this.push=b6;this.value=void 0;this.dirty=false;this.updates=y.Map(function(b8){b7.value=b8;b7.dirty=true;},b5);},_1);_2=c.AttrProxy=bM.Class({},null,_2);_2.Handler=function(b5,b6){return _2.HandlerImpl(b5,b6);};_2.HandlerImpl=function(b5,b6){return _6.Static(function(b7){b7.addEventListener(b5,function(b8){return(b6(b7))(b8);},false);});};_2.OnAfterRenderImpl=function(b5){return new _2({$:4,$0:b5});};_2.Concat=function(b5){var b6;b6=d.ofSeqNonCopying(b5);return d.TreeReduce(_6.EmptyAttr(),_2.Append,b6);};_2.Append=function(b5,b6){return _6.AppendTree(b5,b6);};_2.Create=function(b5,b6){return _6.Static(function(b7){b7.setAttribute(b5,b6);});};_5.New=function(b5,b6,b7,b8){var b9;b9={DynElem:b5,DynFlags:b6,DynNodes:b7};bM.SetOptional(b9,"OnAfterRender",b8);return b9;};_6.Static=function(b5){return new _2({$:3,$0:b5});};_6.Dynamic=function(b5,b6){return new _2({$:1,$0:new _1.New(b5,b6)});};_6.Animated=function(b5,b6,b7){var b8,b9,b_;b8=new _0.New(b5,b6,b7);b9=4;if(V.CanAnimateEnter(b5))b9=b9|1;if(V.CanAnimateExit(b5))b9=b9|2;b_=new _2({$:1,$0:b8});_6.SetFlags(b_,b9);return b_;};_6.EmptyAttr=function(){_.$cctor();return _.EmptyAttr;};_6.AppendTree=function(b5,b6){var b7;return b5===null?b6:b6===null?b5:(b7=new _2({$:2,$0:b5,$1:b6}),(_6.SetFlags(b7,_6.Flags(b5)|_6.Flags(b6)),b7));};_6.GetChangeAnim=function(b5){return _6.GetAnim(b5,function(b6,b7){return b6.NGetChangeAnim(b7);});};_6.GetExitAnim=function(b5){return _6.GetAnim(b5,function(b6,b7){return b6.NGetExitAnim(b7);});};_6.GetEnterAnim=function(b5){return _6.GetAnim(b5,function(b6,b7){return b6.NGetEnterAnim(b7);});};_6.GetAnim=function(b5,b6){return T.Concat(bF.map(function(b7){return b6(b7,b5.DynElem);},b5.DynNodes));};_6.Updates=function(b5){return d.MapTreeReduce(function(b6){return b6.NChanged();},y.Const(),y.Map2Unit,b5.DynNodes);};_6.Empty=function(b5){return _5.New(b5,0,[],null);};_6.Insert=function(b5,b6){var b7,b8,b9;function b_(b$){var ca,cb;while(true)if(!(b$===null)){if(b$!=null&&b$.$==1)return b7.push(b$.$0);else if(b$!=null&&b$.$==2){ca=b$.$1;cb=b$.$0;b_(cb);b$=ca;}else return b$!=null&&b$.$==3?b$.$0(b5):b$!=null&&b$.$==4?b8.push(b$.$0):null;}else return null;}b7=[];b8=[];b_(b6);b9=b7.slice(0);return _5.New(b5,_6.Flags(b6),b9,b8.length===0?null:{$:1,$0:function(b$){bL.iter(function(ca){ca(b$);},b8);}});};_6.Sync=function(b5,b6){bF.iter(function(b7){b7.NSync(b5);},b6.DynNodes);};_6.SetFlags=function(b5,b6){b5.flags=b6;};_6.Flags=function(b5){return b5!==null&&b5.hasOwnProperty("flags")?b5.flags:0;};_6.HasExitAnim=function(b5){var b6;b6=2;return(b5.DynFlags&b6)===b6;};_6.HasEnterAnim=function(b5){var b6;b6=1;return(b5.DynFlags&b6)===b6;};_6.HasChangeAnim=function(b5){var b6;b6=4;return(b5.DynFlags&b6)===b6;};_7=c.CheckedInput=bM.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_7);_7.Make=function(b5){var b6;return new _7({$:0,$0:b5,$1:(b6=b5,a.String(b6))});};_8.FloatApplyChecked=function(){_.$cctor();return _.FloatApplyChecked;};_8.FloatGetChecked=function(){_.$cctor();return _.FloatGetChecked;};_8.FloatSetChecked=function(){_.$cctor();return _.FloatSetChecked;};_8.FloatApplyUnchecked=function(){_.$cctor();return _.FloatApplyUnchecked;};_8.FloatGetUnchecked=function(){_.$cctor();return _.FloatGetUnchecked;};_8.FloatSetUnchecked=function(){_.$cctor();return _.FloatSetUnchecked;};_8.IntApplyChecked=function(){_.$cctor();return _.IntApplyChecked;};_8.IntGetChecked=function(){_.$cctor();return _.IntGetChecked;};_8.IntSetChecked=function(){_.$cctor();return _.IntSetChecked;};_8.IntApplyUnchecked=function(){_.$cctor();return _.IntApplyUnchecked;};_8.IntGetUnchecked=function(){_.$cctor();return _.IntGetUnchecked;};_8.IntSetUnchecked=function(){_.$cctor();return _.IntSetUnchecked;};_8.StringApply=function(){_.$cctor();return _.StringApply;};_8.StringGet=function(){_.$cctor();return _.StringGet;};_8.StringSet=function(){_.$cctor();return _.StringSet;};_8.BoolCheckedApply=function(){_.$cctor();return _.BoolCheckedApply;};_8.ApplyValue=function(b5,b6,b7){var b8;function b9(b_,b$){return b$==null?null:b_(b$.$0);}b8=null;return[function(b_){function b$(){b7.UpdateMaybe(function(ca){var cb;b8=b5(b_);return b8!=null&&b8.$==1&&(!bN.Equals(b8.$0,ca)&&(cb=[b8,b8.$0],true))?cb[0]:null;});}b_.addEventListener("change",b$);b_.addEventListener("input",b$);b_.addEventListener("keypress",b$);},function(b_){var b$;b$=b6(b_);return function(ca){return b9(b$,ca);};},y.Map(function(b_){var b$;return b8!=null&&b8.$==1&&(bN.Equals(b8.$0,b_)&&(b$=b8.$0,true))?null:{$:1,$0:b_};},b7.get_View())];};_9.ValidateForm=function(){return _9.OnAfterRender(function(b5){if(self.H5F)self.H5F.setup(b5);});};_9.Checked=function(b5){return _9.ValueWith(_8.BoolCheckedApply(),b5);};_9.FloatValue=function(b5){return _9.ValueWith(_8.FloatApplyChecked(),b5);};_9.FloatValueUnchecked=function(b5){return _9.ValueWith(_8.FloatApplyUnchecked(),b5);};_9.IntValue=function(b5){return _9.ValueWith(_8.IntApplyChecked(),b5);};_9.IntValueUnchecked=function(b5){return _9.ValueWith(_8.IntApplyUnchecked(),b5);};_9.Value=function(b5){return _9.ValueWith(_8.StringApply(),b5);};_9.ContentEditableHtml=function(b5){var b6;b6=_9.CustomVar(b5,function(b7){return function(b8){b7.innerHTML=b8;};},function(b7){return{$:1,$0:b7.innerHTML};});return _2.Append(_2.Create("contenteditable","true"),b6);};_9.ContentEditableText=function(b5){var b6;b6=_9.CustomVar(b5,function(b7){return function(b8){b7.textContent=b8;};},function(b7){return{$:1,$0:b7.textContent};});return _2.Append(_2.Create("contenteditable","true"),b6);};_9.CustomValue=function(b5,b6,b7){return _9.CustomVar(b5,function(b8){return function(b9){b8.value=b6(b9);};},function(b8){return b7(b8.value);});};_9.CustomVar=function(b5,b6,b7){return _9.ValueWith(function(b8){return _8.ApplyValue(b7,b6,b8);},b5);};_9.ValueWith=function(b5,b6){var b7;b7=b5(b6);return _2.Append(_6.Static(b7[0]),_9.DynamicCustom(b7[1],b7[2]));};_9.DynamicProp=function(b5,b6){return _6.Dynamic(b6,function(b7){return function(b8){b7[b5]=b8;};});};_9.Prop=function(b5,b6){return _6.Static(function(b7){b7[b5]=b6;});};_9.DynamicBool=function(b5,b6){function b7(b8,b9){return b9?b8.setAttribute(b5,""):b8.removeAttribute(b5);}return _6.Dynamic(b6,function(b8){return function(b9){return b7(b8,b9);};});};_9.DynamicPred=function(b5,b6,b7){function b8(b9,b_){return b_[0]?b9.setAttribute(b5,b_[1]):b9.removeAttribute(b5);}return _6.Dynamic(y.Map2(function(b9,b_){return[b9,b_];},b6,b7),function(b9){return function(b_){return b8(b9,b_);};});};_9.DynamicClass=function(b5,b6,b7){return _9.DynamicClassPred(b5,y.Map(b7,b6));};_9.Class=function(b5){return _9.ClassPred(b5,true);};_9.ClassPred=function(b5,b6){return _6.Static(function(b7){if(b6)r.AddClass(b7,b5);else r.RemoveClass(b7,b5);});};_9.DynamicClassPred=function(b5,b6){return _6.Dynamic(b6,function(b7){return function(b8){return b8?r.AddClass(b7,b5):r.RemoveClass(b7,b5);};});};_9.OnAfterRenderView=function(b5,b6){var b7;b7=h.Id();return _2.Append(_9.OnAfterRender(function(b8){b6(b8,b8[b7]);}),_9.DynamicCustom(function(b8){return function(b9){b8[b7]=b9;};},b5));};_9.OnAfterRender=function(b5){return new _2({$:4,$0:b5});};_9.HandlerView=function(b5,b6,b7){return _6.Static(function(b8){var b9;b9=b7(b8);b8.addEventListener(b5,function(b_){return y.Get(b9(b_),b6);},false);});};_9.Handler=function(b5,b6){return _6.Static(function(b7){b7.addEventListener(b5,function(b8){return(b6(b7))(b8);},false);});};_9.DynamicStyle=function(b5,b6){return _6.Dynamic(b6,function(b7){return function(b8){return b7.style.setProperty(b5,b8);};});};_9.DynamicCustom=function(b5,b6){return _6.Dynamic(b6,b5);};_9.Dynamic=function(b5,b6){return _6.Dynamic(b6,function(b7){return function(b8){return b7.setAttribute(b5,b8);};});};_9.AnimatedStyle=function(b5,b6,b7,b8){return _6.Animated(b6,b7,function(b9){return function(b_){var b$;b$=b8(b_);return b9.style.setProperty(b5,b$);};});};_9.Animated=function(b5,b6,b7,b8){return _6.Animated(b6,b7,function(b9){return function(b_){return b9.setAttribute(b5,b8(b_));};});};_9.Style=function(b5,b6){return _6.Static(function(b7){b7.style.setProperty(b5,b6);});};_.$cctor=function(){var b5,b6,b7,b8,b9,b_,b$,ca,cb,cc;_.$cctor=a.ignore;_.EmptyAttr=null;_.BoolCheckedApply=function(cd){function ce(cf,cg){return cg!=null&&cg.$==1?void(cf.checked=cg.$0):null;}return[function(cf){cf.addEventListener("change",function(){return!bN.Equals(cd.Get(),cf.checked)?cd.Set(cf.checked):null;});},function(cf){return function(cg){return ce(cf,cg);};},y.Map(function(cf){return{$:1,$0:cf};},cd.get_View())];};_.StringSet=function(cd){return function(ce){cd.value=ce;};};_.StringGet=function(cd){return{$:1,$0:cd.value};};_.StringApply=(b5=_8.StringGet(),(b6=_8.StringSet(),function(cd){return _8.ApplyValue(b5,b6,cd);}));_.IntSetUnchecked=function(cd){return function(ce){cd.value=a.String(ce);};};_.IntGetUnchecked=function(cd){var ce,cf;ce=cd.value;return e.isBlank(ce)?{$:1,$0:0}:(cf=+ce,cf!==cf>>0?null:{$:1,$0:cf});};_.IntApplyUnchecked=(b7=_8.IntGetUnchecked(),(b8=_8.IntSetUnchecked(),function(cd){return _8.ApplyValue(b7,b8,cd);}));_.IntSetChecked=function(cd){return function(ce){var cf;cf=ce.get_Input();return cd.value!==cf?void(cd.value=cf):null;};};_.IntGetChecked=function(cd){var ce,cf,cg;ce=cd.value;return{$:1,$0:e.isBlank(ce)?(cd.checkValidity?cd.checkValidity():true)?new _7({$:2,$0:ce}):new _7({$:1,$0:ce}):(cf=(cg=0,[bX.TryParseInt32(ce,{get:function(){return cg;},set:function(ch){cg=ch;}}),cg]),cf[0]?new _7({$:0,$0:cf[1],$1:ce}):new _7({$:1,$0:ce}))};};_.IntApplyChecked=(b9=_8.IntGetChecked(),(b_=_8.IntSetChecked(),function(cd){return _8.ApplyValue(b9,b_,cd);}));_.FloatSetUnchecked=function(cd){return function(ce){cd.value=a.String(ce);};};_.FloatGetUnchecked=function(cd){var ce,cf;ce=cd.value;return e.isBlank(ce)?{$:1,$0:0}:(cf=+ce,a.isNaN(cf)?null:{$:1,$0:cf});};_.FloatApplyUnchecked=(b$=_8.FloatGetUnchecked(),(ca=_8.FloatSetUnchecked(),function(cd){return _8.ApplyValue(b$,ca,cd);}));_.FloatSetChecked=function(cd){return function(ce){var cf;cf=ce.get_Input();return cd.value!==cf?void(cd.value=cf):null;};};_.FloatGetChecked=function(cd){var ce,cf;ce=cd.value;return{$:1,$0:e.isBlank(ce)?(cd.checkValidity?cd.checkValidity():true)?new _7({$:2,$0:ce}):new _7({$:1,$0:ce}):(cf=+ce,a.isNaN(cf)?new _7({$:1,$0:ce}):new _7({$:0,$0:cf,$1:ce}))};};_.FloatApplyChecked=(cb=_8.FloatGetChecked(),(cc=_8.FloatSetChecked(),function(cd){return _8.ApplyValue(cb,cc,cd);}));};ba=c.InlineControlWithPlaceHolder=bM.Class({get_Body:function(){return $.prototype.get_Body.call(this);}},$,ba);bb.BatchUpdatesEnabled=function(){bl.$cctor();return bl.BatchUpdatesEnabled;};bb.set_BatchUpdatesEnabled=function(b5){bl.$cctor();bl.BatchUpdatesEnabled=b5;};bc=c.DocElemNode=bM.Class({GetHashCode:function(){return this.ElKey;},Equals:function(b5){return this.ElKey===b5.ElKey;}},null,bc);bc.New=function(b5,b6,b7,b8,b9,b_){var b$;return new bc((b$={Attr:b5,Children:b6,El:b8,ElKey:b9},(bM.SetOptional(b$,"Delimiters",b7),bM.SetOptional(b$,"Render",b_),b$)));};be.FoldBack=function(b5,b6,b7){return bF.foldBack(b5,b6.$0,b7);};be.Iter=function(b5,b6){bF.iter(b5,b6.$0);};be.Except=function(b5,b6){var b7;b7=b5.$0;return{$:0,$0:bF.filter(function(b8){return bF.forall(function(b9){return!(b8===b9);},b7);},b6.$0)};};be.DocChildren=function(b5){var b6;function b7(b8){var b9,b_,b$,ca;while(true){if(b8!=null&&b8.$==2){b_=b8.$0;b8=b_.Current;}else if(b8!=null&&b8.$==1)return b6.push(b8.$0.El);else if(b8==null)return null;else if(b8!=null&&b8.$==5)return b6.push(b8.$0);else if(b8!=null&&b8.$==4)return b6.push(b8.$0.Text);else if(b8!=null&&b8.$==6){b9=b8.$0.Els;return(function(cb){return function(cc){bF.iter(cb,cc);};}(function(cb){if(cb==null||cb.constructor===a.Object)b7(cb);else b6.push(cb);}))(b9);}else{b$=b8.$1;ca=b8.$0;b7(ca);b8=b$;}}}b6=[];b7(b5.Children);return{$:0,$0:d.ofSeqNonCopying(b6)};};be.Children=function(b5,b6){var b7,b8,b9;if(b6!=null&&b6.$==1){b9=[];b7=b6.$0[0].nextSibling;while(b7!==b6.$0[1]){b9.push(b7);b7=b7.nextSibling;}return{$:0,$0:b9};}else return{$:0,$0:bF.init(b5.childNodes.length,(b8=b5.childNodes,function(b_){return b8[b_];}))};};bf.ToArray=function(b5){return i.ToArray(b5.$0);};bf.get_Empty=function(){return{$:0,$0:new bK.New$3()};};bf.IsEmpty=function(b5){return b5.$0.Count()===0;};bf.Intersect=function(b5,b6){return{$:0,$0:i.Intersect(b5.$0,b6.$0)};};bf.Except=function(b5,b6){return{$:0,$0:i.Except(b5.$0,b6.$0)};};bf.FindAll=function(b5){var b6;function b7(b_,b$){var ca,cb,cc,cd,ce;while(true)switch(b_){case 0:if(b$!=null&&b$.$==0){cb=b$.$1;cc=b$.$0;b7(0,cc);b$=cb;}else if(b$!=null&&b$.$==1){cd=b$.$0;b$=cd;b_=1;}else if(b$!=null&&b$.$==2){ce=b$.$0;b$=ce.Current;}else return b$!=null&&b$.$==6?(ca=b$.$0.Holes,(function(cf){return function(cg){bF.iter(cf,cg);};}(b9))(ca)):null;break;case 1:b6.push(b$);b$=b$.Children;b_=0;break;}}function b8(b_){return b7(0,b_);}function b9(b_){return b7(1,b_);}b6=[];b8(b5);return{$:0,$0:new bK.New$2(b6)};};bf.Filter=function(b5,b6){return{$:0,$0:i.Filter(b5,b6.$0)};};bg.New=function(b5,b6){return{PreviousNodes:b5,Top:b6};};bh.UpdateTextNode=function(b5,b6){b5.Value=b6;b5.Dirty=true;};bh.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:false,Value:""};};bh.UpdateEmbedNode=function(b5,b6){b5.Current=b6;b5.Dirty=true;};bh.CreateEmbedNode=function(){return{Current:null,Dirty:false};};bh.PerformSyncUpdate=function(b5,b6,b7){var b8;b8=bf.FindAll(b7);bh.SyncElemNode(b5,b6.Top);b6.PreviousNodes=b8;};bh.PerformAnimatedUpdate=function(b5,b6,b7){var b8;return T.get_UseAnimations()?(b8=null,bP.Delay(function(){var b9,b_,b$;b9=bf.FindAll(b7);b_=bh.ComputeChangeAnim(b6,b9);b$=bh.ComputeEnterAnim(b6,b9);return bP.Bind(T.Play(T.Append(b_,bh.ComputeExitAnim(b6,b9))),function(){return bP.Bind(bh.SyncElemNodesNextFrame(b5,b6),function(){return bP.Bind(T.Play(b$),function(){b6.PreviousNodes=b9;return bP.Return(null);});});});})):bh.SyncElemNodesNextFrame(b5,b6);};bh.SyncElemNodesNextFrame=function(b5,b6){function b7(b8){a.requestAnimationFrame(function(){bh.SyncElemNode(b5,b6.Top);b8();});}return bb.BatchUpdatesEnabled()?bP.FromContinuations(function(b8,b9,b_){return b7.apply(null,[b8,b9,b_]);}):(bh.SyncElemNode(b5,b6.Top),bP.Return(null));};bh.ComputeEnterAnim=function(b5,b6){return T.Concat(bF.map(function(b7){return _6.GetEnterAnim(b7.Attr);},bf.ToArray(bf.Except(b5.PreviousNodes,bf.Filter(function(b7){return _6.HasEnterAnim(b7.Attr);},b6)))));};bh.ComputeChangeAnim=function(b5,b6){var b7;function b8(b9){return _6.HasChangeAnim(b9.Attr);}b7=function(b9){return bf.Filter(b8,b9);};return T.Concat(bF.map(function(b9){return _6.GetChangeAnim(b9.Attr);},bf.ToArray(bf.Intersect(b7(b5.PreviousNodes),b7(b6)))));};bh.ComputeExitAnim=function(b5,b6){return T.Concat(bF.map(function(b7){return _6.GetExitAnim(b7.Attr);},bf.ToArray(bf.Except(b6,bf.Filter(function(b7){return _6.HasExitAnim(b7.Attr);},b5.PreviousNodes)))));};bh.CreateDelimitedRunState=function(b5,b6,b7){return bg.New(bf.get_Empty(),bh.CreateDelimitedElemNode(b5,b6,_6.EmptyAttr(),b7));};bh.CreateRunState=function(b5,b6){return bg.New(bf.get_Empty(),bh.CreateElemNode(b5,_6.EmptyAttr(),b6));};bh.CreateDelimitedElemNode=function(b5,b6,b7,b8){var b9,b_;b9=b5.parentNode;bh.LinkPrevElement(b6,b8);b_=_6.Insert(b9,b7);return bc.New(b_,b8,{$:1,$0:[b5,b6]},b9,h.Int(),bM.GetOptional(b_.OnAfterRender));};bh.CreateElemNode=function(b5,b6,b7){var b8;bh.LinkElement(b5,b7);b8=_6.Insert(b5,b6);return bc.New(b8,b7,null,b5,h.Int(),bM.GetOptional(b8.OnAfterRender));};bh.SyncElemNode=function(b5,b6){!b5?bh.SyncElement(b6):void 0;bh.Sync(b6.Children);bh.AfterRender(b6);};bh.Sync=function(b5){var b6,b7,b8,b9,b_;while(true){if(b5!=null&&b5.$==1)return bh.SyncElemNode(false,b5.$0);else if(b5!=null&&b5.$==2){b8=b5.$0;b5=b8.Current;}else if(b5==null)return null;else if(b5!=null&&b5.$==5)return null;else if(b5!=null&&b5.$==4){b6=b5.$0;return b6.Dirty?(b6.Text.nodeValue=b6.Value,b6.Dirty=false):null;}else if(b5!=null&&b5.$==6){b7=b5.$0;bF.iter(function(b$){bh.SyncElemNode(false,b$);},b7.Holes);bF.iter(function(b$){_6.Sync(b$[0],b$[1]);},b7.Attrs);return bh.AfterRender(b7);}else{b9=b5.$1;b_=b5.$0;bh.Sync(b_);b5=b9;}}};bh.AfterRender=function(b5){var b6;b6=bM.GetOptional(b5.Render);if(b6!=null&&b6.$==1){b6.$0(b5.El);bM.SetOptional(b5,"Render",null);}};bh.InsertBeforeDelim=function(b5,b6){var b7,b8;b7=b5.parentNode;b8=self.document.createTextNode("");b7.insertBefore(b8,b5);bh.LinkPrevElement(b5,b6);return b8;};bh.LinkPrevElement=function(b5,b6){bh.InsertDoc(b5.parentNode,b6,b5);};bh.LinkElement=function(b5,b6){bh.InsertDoc(b5,b6,null);};bh.SyncElement=function(b5){function b6(b7){function b8(b9){var b_,b$,ca,cb;while(true){if(b9!=null&&b9.$==0){b$=b9.$1;ca=b9.$0;if(b8(ca))return true;else b9=b$;}else if(b9!=null&&b9.$==2){cb=b9.$0;if(cb.Dirty)return true;else b9=cb.Current;}else return b9!=null&&b9.$==6&&(b_=b9.$0,b_.Dirty||bF.exists(b6,b_.Holes));}}return b8(b7.Children);}_6.Sync(b5.El,b5.Attr);if(b6(b5))bh.DoSyncElement(b5);};bh.DoSyncElement=function(b5){var b6,b7,b8;function b9(b_,b$){var ca,cb,cc,cd;while(true){if(b_!=null&&b_.$==1)return b_.$0.El;else if(b_!=null&&b_.$==2){cb=b_.$0;if(cb.Dirty){cb.Dirty=false;return bh.InsertDoc(b6,cb.Current,b$);}else b_=cb.Current;}else if(b_==null)return b$;else if(b_!=null&&b_.$==4)return b_.$0.Text;else if(b_!=null&&b_.$==5)return b_.$0;else if(b_!=null&&b_.$==6){ca=b_.$0;ca.Dirty?ca.Dirty=false:void 0;return bF.foldBack(function(ce,cf){return ce==null||ce.constructor===a.Object?b9(ce,cf):ce;},ca.Els,b$);}else{cc=b_.$1;cd=b_.$0;b_=cd;b$=b9(cc,b$);}}}b6=b5.El;be.Iter((b7=b5.El,function(b_){r.RemoveNode(b7,b_);}),be.Except(be.DocChildren(b5),be.Children(b5.El,bM.GetOptional(b5.Delimiters))));b9(b5.Children,(b8=bM.GetOptional(b5.Delimiters),b8!=null&&b8.$==1?b8.$0[1]:null));};bh.InsertDoc=function(b5,b6,b7){var b8,b9,b_;while(true)if(b6!=null&&b6.$==1)return bh.InsertNode(b5,b6.$0.El,b7);else if(b6!=null&&b6.$==2){b8=b6.$0;b8.Dirty=false;b6=b8.Current;}else if(b6==null)return b7;else if(b6!=null&&b6.$==4)return bh.InsertNode(b5,b6.$0.Text,b7);else if(b6!=null&&b6.$==5)return bh.InsertNode(b5,b6.$0,b7);else if(b6!=null&&b6.$==6)return bF.foldBack(function(b$,ca){return(((bM.Curried3(function(cb,cc,cd){return cc==null||cc.constructor===a.Object?bh.InsertDoc(cb,cc,cd):bh.InsertNode(cb,cc,cd);}))(b5))(b$))(ca);},b6.$0.Els,b7);else{b9=b6.$1;b_=b6.$0;b6=b_;b7=bh.InsertDoc(b5,b9,b7);}};bh.InsertNode=function(b5,b6,b7){r.InsertAt(b5,b7,b6);return b6;};bi=c.Doc=bM.Class({ReplaceInDom:function(b5){var b6;b6=self.document.createTextNode("");b5.parentNode.replaceChild(b6,b5);bi.RunBefore(b6,this);}},k,bi);bi.SvgElementMixed=function(b5,b6){var b7;b7=bi.MixedNodes(b6);return bi.SvgElement(b5,b7[0],b7[1]);};bi.SvgElement=function(b5,b6,b7){var b8,b9;b8=_2.Concat(b6);b9=bi.Concat(b7);return bj.New(self.document.createElementNS("http://www.w3.org/2000/svg",b5),b8,b9);};bi.ElementMixed=function(b5,b6){var b7;b7=bi.MixedNodes(b6);return bi.Element(b5,b7[0],b7[1]);};bi.ConcatMixed=function(b5){return bi.Concat(bL.map(bi.ToMixedDoc,b5));};bi.MixedNodes=function(b5){var b6,b7,b8,b9;b6=bM.MarkResizable([]);b7=bM.MarkResizable([]);b8=bG.Get(b5);try{while(b8.MoveNext()){b9=b8.Current();if(b9 instanceof _2)b6.push(b9);else b7.push(bi.ToMixedDoc(b9));}}finally{if(typeof b8=="object"&&"Dispose"in b8)b8.Dispose();}return[b6,b7];};bi.ToMixedDoc=function(b5){return b5 instanceof bi?b5:typeof b5=="string"?bi.TextNode(b5):b5 instanceof a.Element?bi.StaticProxy(b5):typeof b5=="function"?bi.EmbedView(y.Map(bi.ToMixedDoc,b5)):b5 instanceof x?bi.EmbedView(y.Map(bi.ToMixedDoc,b5.get_View())):bN.Equals(b5,null)?bi.get_Empty():bi.TextNode(a.String(b5));};bi.Element=function(b5,b6,b7){var b8,b9;b8=_2.Concat(b6);b9=bi.Concat(b7);return bj.New(self.document.createElement(b5),b8,b9);};bi.Radio=function(b5,b6,b7){var b8,b9;b8=self.document.createElement("input");b8.addEventListener("click",function(){return b7.Set(b6);},false);b9=_9.DynamicProp("checked",y.Map(function(b_){return bN.Equals(b_,b6);},b7.get_View()));return bj.New(b8,_2.Concat(bE.append(bE.ofArray([_2.Create("type","radio"),_2.Create("name",b7.get_Id()),b9]),bE.ofSeq(b5))),bi.get_Empty());};bi.LinkView=function(b5,b6,b7,b8){var b9;b9=_2.Concat(bL.append([_9.HandlerView("click",b7,function(){return function(){return b8;};}),_2.Create("href","#")],b6));return bj.New(self.document.createElement("a"),b9,bi.TextNode(b5));};bi.Link=function(b5,b6,b7){var b8,b9;b8=(b9=_2.Concat(b6),_2.Append(_2.Create("href","#"),b9));return bj.New(bi.Clickable("a",b7),b8,bi.TextNode(b5));};bi.ButtonView=function(b5,b6,b7,b8){var b9;b9=_2.Concat(bL.append([_9.HandlerView("click",b7,function(){return function(){return b8;};})],b6));return bj.New(self.document.createElement("button"),b9,bi.TextNode(b5));};bi.Button=function(b5,b6,b7){var b8;b8=_2.Concat(b6);return bj.New(bi.Clickable("button",b7),b8,bi.TextNode(b5));};bi.Clickable=function(b5,b6){var b7;b7=self.document.createElement(b5);b7.addEventListener("click",function(b8){b8.preventDefault();return b6();},false);return b7;};bi.CheckBoxGroup=function(b5,b6,b7){function b8(b9){return bN.Equals(b6,b9);}return bi.CheckBox(b5,A.Lens(b7,function(b9){return bE.exists(b8,b9);},function(b9,b_){return b_?bE.exists(function(b$){return bN.Equals(b6,b$);},b9)?b9:new bE.T({$:1,$0:b6,$1:b9}):bE.filter(function(b$){return!bN.Equals(b6,b$);},b9);}));};bi.CheckBox=function(b5,b6){return bi.InputInternal("input",function(){return bL.append(b5,[_2.Create("type","checkbox"),_9.Checked(b6)]);});};bi.SelectDynOptional=function(b5,b6,b7,b8,b9){return bi.SelectDyn(b5,function(b_){return b_!=null&&b_.$==1?b7(b_.$0):b6;},y.Map(function(b_){return new bE.T({$:1,$0:null,$1:bE.map(function(b$){return{$:1,$0:b$};},b_)});},b8),b9);};bi.SelectOptional=function(b5,b6,b7,b8,b9){return bi.Select(b5,function(b_){return b_!=null&&b_.$==1?b7(b_.$0):b6;},new bE.T({$:1,$0:null,$1:bE.map(function(b_){return{$:1,$0:b_};},b8)}),b9);};bi.Select=function(b5,b6,b7,b8){return bi.SelectImpl(b5,b6,function(b9){b9[0]=b7;return bi.Concat(bE.mapi(function(b_,b$){return bi.Element("option",bE.ofArray([_2.Create("value",a.String(b_))]),bE.ofArray([bi.TextNode(b6(b$))]));},b7));},b8);};bi.SelectDyn=function(b5,b6,b7,b8){return bi.SelectImpl(b5,b6,function(b9){function b_(b$,ca){return bi.Element("option",bE.ofArray([_2.Create("value",a.String(b$))]),bE.ofArray([bi.TextNode(b6(ca))]));}return bi.Convert(function(b$){return b_(b$[0],b$[1]);},y.Map(function(b$){b9[0]=b$;return bL.mapi(function(ca,cb){return[ca,cb];},b$);},b7));},b8);};bi.SelectImpl=function(b5,b6,b7,b8){var b9,b_,b$,ca;function cb(cg){return cg.selectedIndex;}function cc(cg,ch){cg.selectedIndex=ch;}function cd(cg){var ch;ch=cb(cg);return b9[0].get_Item(ch);}function ce(cg){return bL.findIndex(function(ch){return bN.Equals(cg,ch);},b9[0]);}function cf(cg,ch){return cc(cg,ce(ch));}b9=[bE.T.Empty];b_=self.document.createElement("select");b$=_9.DynamicCustom(function(cg){return function(ch){return cf(cg,ch);};},b8.get_View());b_.addEventListener("change",function(){b8.UpdateMaybe(function(cg){var ch;ch=cd(b_);return bN.Equals(cg,ch)?null:{$:1,$0:ch};});},false);return bj.New(b_,(ca=_2.Append(b$,_2.Concat(b5)),_2.Append(_9.OnAfterRender(function(cg){cf(cg,b8.Get());}),ca)),b7(b9));};bi.InputArea=function(b5,b6){return bi.InputInternal("textarea",function(){return bL.append(b5,[_9.Value(b6)]);});};bi.FloatInput=function(b5,b6){return bi.InputInternal("input",function(){return bL.append(b5,[_9.FloatValue(b6),_2.Create("type","number")]);});};bi.FloatInputUnchecked=function(b5,b6){return bi.InputInternal("input",function(){return bL.append(b5,[b6.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.FloatValueUnchecked(b6),_2.Create("type","number")]);});};bi.IntInput=function(b5,b6){return bi.InputInternal("input",function(){return bL.append(b5,[_9.IntValue(b6),_2.Create("type","number")]);});};bi.IntInputUnchecked=function(b5,b6){return bi.InputInternal("input",function(){return bL.append(b5,[b6.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.IntValueUnchecked(b6),_2.Create("type","number")]);});};bi.PasswordBox=function(b5,b6){return bi.InputInternal("input",function(){return bL.append(b5,[_9.Value(b6),_2.Create("type","password")]);});};bi.Input=function(b5,b6){return bi.InputInternal("input",function(){return bL.append(b5,[_9.Value(b6)]);});};bi.InputInternal=function(b5,b6){var b7;b7=self.document.createElement(b5);return bj.New(b7,_2.Concat(b6(b7)),bi.get_Empty());};bi.ConvertSeqVarBy=function(b5,b6,b7){return bi.Flatten(A.MapLens(b5,b6,b7));};bi.ConvertSeqBy=function(b5,b6,b7){return bi.Flatten(y.MapSeqCachedViewBy(b5,function(b8,b9){return(b6(b8))(b9);},b7));};bi.ConvertSeq=function(b5,b6){return bi.Flatten(y.MapSeqCachedView(b5,b6));};bi.ConvertBy=function(b5,b6,b7){return bi.Flatten(y.MapSeqCachedBy(b5,b6,b7));};bi.Convert=function(b5,b6){return bi.Flatten(y.MapSeqCached(b5,b6));};bi.Flatten=function(b5){return bi.EmbedView(y.Map(bi.Concat,b5));};bi.TextView=function(b5){var b6;b6=bh.CreateTextNode();return bi.Mk({$:4,$0:b6},y.Map(function(b7){bh.UpdateTextNode(b6,b7);},b5));};bi.RunReplaceById=function(b5,b6){var b7;b7=self.document.getElementById(b5);if(bN.Equals(b7,null))bS.FailWith("invalid id: "+b5);else b6.ReplaceInDom(b7);};bi.RunById=function(b5,b6){var b7;b7=self.document.getElementById(b5);if(bN.Equals(b7,null))bS.FailWith("invalid id: "+b5);else bi.Run(b7,b6);};bi.Run=function(b5,b6){bh.LinkElement(b5,b6.docNode);bi.RunInPlace(false,b5,b6);};bi.RunInPlace=function(b5,b6,b7){var b8;b8=bh.CreateRunState(b6,b7.docNode);y.Sink(T.get_UseAnimations()||bb.BatchUpdatesEnabled()?n.StartProcessor(bh.PerformAnimatedUpdate(b5,b8,b7.docNode)):function(){bh.PerformSyncUpdate(b5,b8,b7.docNode);},b7.updates);};bi.RunPrependById=function(b5,b6){var b7;b7=self.document.getElementById(b5);if(bN.Equals(b7,null))bS.FailWith("invalid id: "+b5);else bi.RunPrepend(b7,b6);};bi.RunPrepend=function(b5,b6){var b7;b7=self.document.createTextNode("");b5.insertBefore(b7,b5.firstChild);bi.RunBefore(b7,b6);};bi.RunAppendById=function(b5,b6){var b7;b7=self.document.getElementById(b5);if(bN.Equals(b7,null))bS.FailWith("invalid id: "+b5);else bi.RunAppend(b7,b6);};bi.RunAppend=function(b5,b6){var b7;b7=self.document.createTextNode("");b5.appendChild(b7);bi.RunBefore(b7,b6);};bi.RunAfterById=function(b5,b6){var b7;b7=self.document.getElementById(b5);if(bN.Equals(b7,null))bS.FailWith("invalid id: "+b5);else bi.RunAfter(b7,b6);};bi.RunAfter=function(b5,b6){var b7;b7=self.document.createTextNode("");b5.parentNode.insertBefore(b7,b5.nextSibling);bi.RunBetween(b5,b7,b6);};bi.RunBeforeById=function(b5,b6){var b7;b7=self.document.getElementById(b5);if(bN.Equals(b7,null))bS.FailWith("invalid id: "+b5);else bi.RunBefore(b7,b6);};bi.RunBefore=function(b5,b6){var b7;b7=self.document.createTextNode("");b5.parentNode.insertBefore(b7,b5);bi.RunBetween(b7,b5,b6);};bi.RunBetween=function(b5,b6,b7){var b8;bh.LinkPrevElement(b6,b7.docNode);b8=bh.CreateDelimitedRunState(b5,b6,b7.docNode);y.Sink(T.get_UseAnimations()||bb.BatchUpdatesEnabled()?n.StartProcessor(bh.PerformAnimatedUpdate(false,b8,b7.docNode)):function(){bh.PerformSyncUpdate(false,b8,b7.docNode);},b7.updates);};bi.Async=function(b5){return bi.EmbedView(y.MapAsync(a.id,y.Const(b5)));};bi.BindView=function(b5,b6){return bi.EmbedView(y.Map(b5,b6));};bi.EmbedView=function(b5){var b6;b6=bh.CreateEmbedNode();return bi.Mk({$:2,$0:b6},y.Map(a.ignore,y.Bind(function(b7){bh.UpdateEmbedNode(b6,b7.docNode);return b7.updates;},b5)));};bi.Verbatim=function(b5){return bi.Mk(d.MapTreeReduce(function(b6){return bN.Equals(b6.nodeType,bY.TEXT_NODE)?{$:5,$0:b6}:{$:1,$0:bh.CreateElemNode(b6,_6.EmptyAttr(),null)};},null,function(b6,b7){return{$:0,$0:b6,$1:b7};},r.ChildrenArray(r.ParseHTMLIntoFakeRoot(b5))),y.Const());};bi.StaticProxy=function(b5){return bj.New(b5,_6.EmptyAttr(),bi.get_Empty());};bi.TextNode=function(b5){return bi.Mk({$:5,$0:self.document.createTextNode(b5)},y.Const());};bi.get_Empty=function(){return bi.Mk(null,y.Const());};bi.Concat=function(b5){var b6;b6=d.ofSeqNonCopying(b5);return d.TreeReduce(bi.get_Empty(),bi.Append,b6);};bi.Append=function(b5,b6){return bi.Mk({$:0,$0:b5.docNode,$1:b6.docNode},y.Map2Unit(b5.updates,b6.updates));};bi.Mk=function(b5,b6){return new bi.New(b5,b6);};bi.New=bM.Ctor(function(b5,b6){k.New.call(this);this.docNode=b5;this.updates=b6;},bi);bj=c.Elt=bM.Class({SetStyle:function(b5,b6){this.elt.style[b5]=b6;},HasClass:function(b5){return(new a.RegExp("(\\s|^)"+b5+"(\\s|$)")).test(this.elt.className);},GetProperty:function(b5){return this.elt[b5];},SetProperty:function(b5,b6){this.elt[b5]=b6;},RemoveAttribute:function(b5){this.elt.removeAttribute(b5);},HasAttribute:function(b5){return this.elt.hasAttribute(b5);},GetAttribute:function(b5){return this.elt.getAttribute(b5);},SetAttribute:function(b5,b6){this.elt.setAttribute(b5,b6);},SetText:function(b5){var b6;b6=this.docNode$1;if(b6!=null&&b6.$==1)b6.$0.Children=null;else b6!=null&&b6.$==6?(b6.$0.Els=[],this.ClearHoles()):bS.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=b5;},GetText:function(){return this.elt.textContent;},SetValue:function(b5){this.elt.value=b5;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var b5;b5=this.docNode$1;if(b5!=null&&b5.$==1)b5.$0.Children=null;else b5!=null&&b5.$==6?(b5.$0.Els=[],this.ClearHoles()):bS.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(b5){var b6,b7,b8,b9,b_;b6=this.docNode$1;if(b6!=null&&b6.$==1){b7=b6.$0;b7.Children={$:0,$0:b5.docNode,$1:b7.Children};bh.InsertDoc(this.elt,b5.docNode,(b8=this.elt.firstChild,bN.Equals(b8,null)?null:b8));}else b6!=null&&b6.$==6?(b9=this.elt.insertBefore(self.document.createTextNode(""),this.elt.firstChild),b_=bh.InsertBeforeDelim(b9,b5.docNode),this.AddHole(bc.New(_6.Empty(this.elt),b5.docNode,{$:1,$0:[b_,b9]},this.elt,h.Int(),null))):bS.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b5.updates));},Append:function(b5){var b6,b7,b8,b9;b6=this.docNode$1;if(b6!=null&&b6.$==1){b7=b6.$0;b7.Children={$:0,$0:b7.Children,$1:b5.docNode};bh.InsertDoc(this.elt,b5.docNode,null);}else b6!=null&&b6.$==6?(b8=this.elt.appendChild(self.document.createTextNode("")),b9=bh.InsertBeforeDelim(b8,b5.docNode),this.AddHole(bc.New(_6.Empty(this.elt),b5.docNode,{$:1,$0:[b9,b8]},this.elt,h.Int(),null))):bS.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b5.updates));},ToUpdater:function(){var b5,b6,b7;return new bk.New((b5=this.docNode$1,b5!=null&&b5.$==1?bM.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,b5.$0.Attr]],Render:(b6=null,b6?b6.$0:void 0),El:(b7={$:1,$0:this.elt},b7?b7.$0:void 0)},["Render","El"]):b5!=null&&b5.$==6?b5.$0:bS.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,A.Create$1([]));},OnAfterRenderView:function(b5,b6){var b7,b8;b7=this;b8=h.Id();this.Append(bi.BindView(function(b9){b7.elt[b8]=b9;return bi.get_Empty();},b5));return this["OnAfterRender'"](function(b9){b6(b9,b9[b8]);});},OnAfterRender:function(b5){return this["OnAfterRender'"](b5);},"OnAfterRender'":function(b5){var b6,b7,b8,b9,b_,b$,ca;b6=this.docNode$1;if(b6!=null&&b6.$==1){b7=b6.$0;bM.SetOptional(b7,"Render",(b8=bM.GetOptional(b7.Render),b8!=null&&b8.$==1?(b9=b8.$0,{$:1,$0:function(cb){b9(cb);b5(cb);}}):{$:1,$0:b5}));}else b6!=null&&b6.$==6?(b_=b6.$0,bM.SetOptional(b_,"Render",(b$=bM.GetOptional(b_.Render),b$!=null&&b$.$==1?(ca=b$.$0,{$:1,$0:function(cb){ca(cb);b5(cb);}}):{$:1,$0:b5}))):bS.FailWith("Invalid docNode in Elt");return this;},onView:function(b5,b6,b7){var b8;b8=b7(this.elt);this.elt.addEventListener(b5,function(b9){return y.Get(b8(b9),b6);},false);return this;},on:function(b5,b6){var b7;b7=this;this.elt.addEventListener(b5,function(b8){return b6(b7.elt,b8);},false);return this;},ClearHoles:function(){var b5;b5=this.docNode$1;if(b5!=null&&b5.$==6)b5.$0.Holes=[];},AddHole:function(b5){var b6;b6=this.docNode$1;if(b6!=null&&b6.$==6)b6.$0.Holes.push(b5);}},bi,bj);bj.TreeNode=function(b5,b6){var b7,b8;function b9(b_,b$){return _6.Updates(b$);}b7=B.Create(b6);return new bj.New$1({$:6,$0:b5},y.Map2Unit((b8=bF.map(function(b_){return b9(b_[0],b_[1]);},b5.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,b8)),b7.v),bF.get(b5.Els,0),b7);};bj.New=function(b5,b6,b7){var b8,b9;b8=bh.CreateElemNode(b5,b6,b7.docNode);b9=B.Create(b7.updates);return new bj.New$1({$:1,$0:b8},y.Map2Unit(_6.Updates(b8.Attr),b9.v),b5,b9);};bj.New$1=bM.Ctor(function(b5,b6,b7,b8){bi.New.call(this,b5,b6);this.docNode$1=b5;this.updates$1=b6;this.elt=b7;this.rvUpdates=b8;},bj);bk=_3.EltUpdater=bM.Class({ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];this.holeUpdates.Set([]);},AddHole:function(b5){this.origHoles.push(b5);this.treeNode.Holes=this.treeNode.Holes.concat([b5]);},RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;this.holeUpdates.Set([]);},RemoveUpdated:function(b5){var b6,b7;function b8(b9){return b9!==b7;}b6=b5.docNode;if(b6!=null&&b6.$==1){b7=b6.$0.ElKey;this.treeNode.Holes=bF.filter(function(b9){return b9.ElKey!==b7;},this.treeNode.Holes);this.holeUpdates.Set(bF.filter(function(b9){return b8(b9[0]);},this.holeUpdates.Get()));}else bS.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(b5){var b6,b7,b8;b6=b5.docNode;if(b6!=null&&b6.$==1){b7=b6.$0;this.treeNode.Holes=this.treeNode.Holes.concat([b7]);b8=this.holeUpdates.Get();b8.push([b7.ElKey,b5.updates]);this.holeUpdates.Set(b8);}else bS.FailWith("DocUpdater.AddUpdated expects a single element node");}},bj,bk);bk.New=bM.Ctor(function(b5,b6,b7,b8,b9){var b_,b$,ca,cb;function cc(cd){return cd[1];}bj.New$1.call(this,{$:6,$0:b5},y.Map2Unit(b6,(b_=b9.get_View(),y.BindInner((b$=function(cd){return bF.map(cc,cd);},(ca=(cb=y.Const(),function(cd){return d.TreeReduce(cb,y.Map2Unit,cd);}),function(cd){return ca(b$(cd));})),b_))),b7,b8);this.treeNode=b5;this.holeUpdates=b9;this.origHoles=this.treeNode.Holes;},bk);bl.$cctor=function(){bl.$cctor=a.ignore;bl.BatchUpdatesEnabled=true;};bn.failNotLoaded=function(b5){bO.warn("Instantiating non-loaded template",b5);};bn.fill=function(b5,b6,b7){while(true)if(b5.hasChildNodes())b7=b6.insertBefore(b5.lastChild,b7);else return null;};bn.fillTextHole=function(b5,b6,b7){var b8;b8=b5.querySelector("[ws-replace]");return bN.Equals(b8,null)?(bO.warn("Filling non-existent text hole",b7),null):(b8.parentNode.replaceChild(self.document.createTextNode(b6),b8),{$:1,$0:b8.getAttribute("ws-replace")});};bn.removeHolesExcept=function(b5,b6){function b7(b8){bm.foreachNotPreserved(b5,"["+b8+"]",function(b9){if(!b6.Contains(b9.getAttribute(b8)))b9.removeAttribute(b8);});}b7("ws-attr");b7("ws-onafterrender");b7("ws-var");bm.foreachNotPreserved(b5,"[ws-hole]",function(b8){if(!b6.Contains(b8.getAttribute("ws-hole"))){b8.removeAttribute("ws-hole");while(b8.hasChildNodes())b8.removeChild(b8.lastChild);}});bm.foreachNotPreserved(b5,"[ws-replace]",function(b8){if(!b6.Contains(b8.getAttribute("ws-replace")))b8.parentNode.removeChild(b8);});bm.foreachNotPreserved(b5,"[ws-on]",function(b8){b8.setAttribute("ws-on",bH.concat(" ",bF.filter(function(b9){return b6.Contains(bF.get(bH.SplitChars(b9,[":"],1),1));},bH.SplitChars(b8.getAttribute("ws-on"),[" "],1))));});bm.foreachNotPreserved(b5,"[ws-attr-holes]",function(b8){var b9,b_,b$,ca,cb;b9=bH.SplitChars(b8.getAttribute("ws-attr-holes"),[" "],1);for(b_=0,b$=b9.length-1;b_<=b$;b_++){ca=bF.get(b9,b_);b8.setAttribute(ca,(cb=new a.RegExp(bm.TextHoleRE(),"g"),b8.getAttribute(ca).replace(cb,function(cc,cd){return b6.Contains(cd)?cc:"";})));}});};bn.fillInstanceAttrs=function(b5,b6){var b7,b8,b9,b_,b$;bn.convertAttrs(b6);b7=b6.nodeName.toLowerCase();b8=b5.querySelector("[ws-attr="+b7+"]");if(bN.Equals(b8,null))bO.warn("Filling non-existent attr hole",b7);else{b8.removeAttribute("ws-attr");for(b9=0,b_=b6.attributes.length-1;b9<=b_;b9++){b$=b6.attributes.item(b9);if(b$.name==="class"&&b8.hasAttribute("class"))b8.setAttribute("class",b8.getAttribute("class")+" "+b$.nodeValue);else b8.setAttribute(b$.name,b$.nodeValue);}}};bn.mapHoles=function(b5,b6){function b7(b8){bm.foreachNotPreserved(b5,"["+b8+"]",function(b9){var b_,b$;b_=(b$=null,[b6.TryGetValue(b9.getAttribute(b8).toLowerCase(),{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);if(b_[0])b9.setAttribute(b8,b_[1]);});}b7("ws-hole");b7("ws-replace");b7("ws-attr");b7("ws-onafterrender");b7("ws-var");bm.foreachNotPreserved(b5,"[ws-on]",function(b8){b8.setAttribute("ws-on",bH.concat(" ",bF.map(function(b9){var b_,b$,ca;b_=bH.SplitChars(b9,[":"],1);b$=(ca=null,[b6.TryGetValue(bF.get(b_,1),{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);return b$[0]?bF.get(b_,0)+":"+b$[1]:b9;},bH.SplitChars(b8.getAttribute("ws-on"),[" "],1))));});bm.foreachNotPreserved(b5,"[ws-attr-holes]",function(b8){var b9,b_,b$;b9=bH.SplitChars(b8.getAttribute("ws-attr-holes"),[" "],1);for(b_=0,b$=b9.length-1;b_<=b$;b_++)(function(){var ca;function cb(cc,cd){var ce;ce=bS.KeyValue(cd);return cc.replace(new a.RegExp("\\${"+ce[0]+"}","ig"),"${"+ce[1]+"}");}ca=bF.get(b9,b_);return b8.setAttribute(ca,(((bM.Curried3(bL.fold))(cb))(b8.getAttribute(ca)))(b6));}());});};bn.convertTextNode=function(b5){var b6,b7,b8,b9,b_,b$;b6=null;b7=0;b9=b5.textContent;b_=new a.RegExp(bm.TextHoleRE(),"g");while(b6=b_.exec(b9),b6!==null){b5.parentNode.insertBefore(self.document.createTextNode(bZ.string(b9,{$:1,$0:b7},{$:1,$0:b_.lastIndex-bF.get(b6,0).length-1})),b5);b7=b_.lastIndex;b$=self.document.createElement("span");b$.setAttribute("ws-replace",bF.get(b6,1).toLowerCase());b5.parentNode.insertBefore(b$,b5);}b_.lastIndex=0;b5.textContent=bZ.string(b9,{$:1,$0:b7},null);};bn.convertAttrs=function(b5){var b7,b8,b9,b_,b$,ca,cb,cc;function b6(cd){var ce;ce=b5.getAttribute(cd);if(ce===null);else b5.setAttribute(cd,ce.toLowerCase());}b7=b5.attributes;b8=[];b9=[];b_=[];for(b$=0,ca=b7.length-1;b$<=ca;b$++){cb=b7.item(b$);if(bH.StartsWith(cb.nodeName,"ws-on")&&cb.nodeName!=="ws-onafterrender"&&cb.nodeName!=="ws-on"){b8.push(cb.nodeName);b9.push(bZ.string(cb.nodeName,{$:1,$0:"ws-on".length},null)+":"+cb.nodeValue.toLowerCase());}else!bH.StartsWith(cb.nodeName,"ws-")&&(new a.RegExp(bm.TextHoleRE())).test(cb.nodeValue)?(cb.nodeValue=(cc=new a.RegExp(bm.TextHoleRE(),"g"),cb.nodeValue.replace(cc,function(cd,ce){return"${"+ce.toLowerCase()+"}";})),b_.push(cb.nodeName)):void 0;}if(!(b9.length==0))b5.setAttribute("ws-on",bH.concat(" ",b9));if(!(b_.length==0))b5.setAttribute("ws-attr-holes",bH.concat(" ",b_));b6("ws-hole");b6("ws-replace");b6("ws-attr");b6("ws-onafterrender");b6("ws-var");bF.iter(function(cd){b5.removeAttribute(cd);},b8);};bm.GetOrLoadTemplate=function(b5,b6,b7,b8){bm.LoadLocalTemplates("");bm.PrepareTemplate(b5,b6,b7);return bm.NamedTemplate(b5,b6,b8);};bm.NamedTemplate=function(b5,b6,b7){var b8,b9;b8=(b9=null,[bm.LoadedTemplateFile(b5).TryGetValue(b6==null?"":b6.$0,{get:function(){return b9;},set:function(b_){b9=b_;}}),b9]);return b8[0]?bm.ChildrenTemplate(b8[1].cloneNode(true),b7):(bO.warn("Local template doesn't exist",b6),bi.get_Empty());};bm.RunFullDocTemplate=function(b5){var b6,b7,b8;return bm.RenderedFullDocTemplate()==null?(b6=(bm.LoadLocalTemplates(""),bm.PrepareTemplateStrict("",null,self.document.body,null),b7=bm.ChildrenTemplate(self.document.body,b5),b8=self.document.body,function(b9){bi.RunInPlace(true,b8,b9);}(b7),b7),(bm.set_RenderedFullDocTemplate({$:1,$0:b6}),b6)):bm.RenderedFullDocTemplate().$0;};bm.RenderedFullDocTemplate=function(){bo.$cctor();return bo.RenderedFullDocTemplate;};bm.set_RenderedFullDocTemplate=function(b5){bo.$cctor();bo.RenderedFullDocTemplate=b5;};bm.LoadLocalTemplates=function(b5){!bm.LocalTemplatesLoaded()?(bm.set_LocalTemplatesLoaded(true),bm.LoadNestedTemplates(self.document.body,"")):void 0;bm.LoadedTemplates().set_Item(b5,bm.LoadedTemplateFile(""));};bm.LoadNestedTemplates=function(b5,b6){var b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci;function b7(cj){var ck,cl;if(!b8.ContainsKey(cj)){ck=(cl=null,[b9.TryGetValue(cj,{get:function(){return cl;},set:function(cm){cl=cm;}}),cl]);if(ck[0]){ci.SAdd(cj);b9.RemoveKey(cj);bm.PrepareTemplateStrict(b6,{$:1,$0:cj},ck[1],{$:1,$0:b7});}else bO.warn(ci.Contains(cj)?"Encountered loop when instantiating "+cj:"Local template does not exist: "+cj);}}b8=bm.LoadedTemplateFile(b6);b9=new bV.New$5();b_=b5.querySelectorAll("[ws-template]");for(b$=0,ca=b_.length-1;b$<=ca;b$++){cb=b_[b$];cc=cb.getAttribute("ws-template").toLowerCase();cb.removeAttribute("ws-template");b9.set_Item(cc,bm.FakeRootSingle(cb));}cd=b5.querySelectorAll("[ws-children-template]");for(ce=0,cf=cd.length-1;ce<=cf;ce++){cg=cd[ce];ch=cg.getAttribute("ws-children-template").toLowerCase();cg.removeAttribute("ws-children-template");b9.set_Item(ch,bm.FakeRoot(cg));}ci=new bK.New$3();while(b9.count>0)b7(bL.head(b9.Keys()));};bm.PrepareTemplate=function(b5,b6,b7){if(!bm.LoadedTemplateFile(b5).ContainsKey(b6==null?"":b6.$0))bm.PrepareTemplateStrict(b5,b6,b7(),null);};bm.PrepareSingleTemplate=function(b5,b6,b7){var b8;b8=bm.FakeRootSingle(b7);return function(b9){bm.PrepareTemplateStrict(b5,b6,b8,b9);};};bm.PrepareTemplateStrict=function(b5,b6,b7,b8){var b9;function b_(ce,cf){var cg,ch,ci,cj,ck,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG;function cl(cH){}while(true)switch(ce){case 0:if(cf!==null){cg=cf.nextSibling;if(bN.Equals(cf.nodeType,bY.TEXT_NODE))bn.convertTextNode(cf);else if(bN.Equals(cf.nodeType,bY.ELEMENT_NODE))ca(cf);cf=cg;}else return null;break;case 1:cm=bZ.string(cf.nodeName,{$:1,$0:3},null).toLowerCase();cn=(ch=cm.indexOf("."),ch===-1?[b5,cm]:[bZ.string(cm,null,{$:1,$0:ch-1}),bZ.string(cm,{$:1,$0:ch+1},null)]);co=cn[1];cp=cn[0];if(cp!==""&&!bm.LoadedTemplates().ContainsKey(cp))return bn.failNotLoaded(co);else{if(cp===""&&b8!=null)b8.$0(co);cq=bm.LoadedTemplates().Item(cp);if(!cq.ContainsKey(co))return bn.failNotLoaded(co);else{cr=cq.Item(co);cs=cr.cloneNode(true);ct=new bK.New$3();cu=new bV.New$5();cv=cf.attributes;for(cw=0,cx=cv.length-1;cw<=cx;cw++){cy=cv.item(cw).name.toLowerCase();cu.set_Item(cy,(cz=cv.item(cw).nodeValue,cz===""?cy:cz.toLowerCase()));if(!ct.SAdd(cy))bO.warn("Hole mapped twice",cy);}for(cA=0,cB=cf.childNodes.length-1;cA<=cB;cA++){cC=cf.childNodes[cA];if(bN.Equals(cC.nodeType,bY.ELEMENT_NODE))!ct.SAdd(cC.nodeName.toLowerCase())?bO.warn("Hole filled twice",co):void 0;}cD=cf.childNodes.length===1&&bN.Equals(cf.firstChild.nodeType,bY.TEXT_NODE);if(cD){cj=bn.fillTextHole(cs,cf.firstChild.textContent,co);((function(cH){return function(cI){if(cI!=null)cH(cI.$0);};}((ck=function(cH){return function(cI){return cH.SAdd(cI);};}(ct),function(cH){return cl(ck(cH));})))(cj));}bn.removeHolesExcept(cs,ct);if(!cD){for(cE=0,cF=cf.childNodes.length-1;cE<=cF;cE++){cG=cf.childNodes[cE];if(bN.Equals(cG.nodeType,bY.ELEMENT_NODE))cG.hasAttributes()?bn.fillInstanceAttrs(cs,cG):b$(cs,cG);}}bn.mapHoles(cs,cu);bn.fill(cs,cf.parentNode,cf);cf.parentNode.removeChild(cf);return;}}break;}}function b$(ce,cf){var cg,ci,cj;function ch(ck,cl){var cm;if(ci==="title"&&cf.hasChildNodes()){cm=r.ParseHTMLIntoFakeRoot(cf.textContent);cf.removeChild(cf.firstChild);while(cm.hasChildNodes())cf.appendChild(cm.firstChild);}else null;ca(cf);return bn.fill(cf,ck,cl);}ci=cf.nodeName.toLowerCase();bm.foreachNotPreserved(ce,"[ws-attr-holes]",function(ck){var cl,cm,cn,co,cp;cl=bH.SplitChars(ck.getAttribute("ws-attr-holes"),[" "],1);for(cm=0,cn=cl.length-1;cm<=cn;cm++){co=bF.get(cl,cm);ck.setAttribute(co,(cp=new a.RegExp("\\${"+ci+"}","ig"),ck.getAttribute(co).replace(cp,cf.textContent)));}});cj=ce.querySelector("[ws-hole="+ci+"]");if(bN.Equals(cj,null)){cg=ce.querySelector("[ws-replace="+ci+"]");return bN.Equals(cg,null)?null:(ch(cg.parentNode,cg),void cg.parentNode.removeChild(cg));}else{while(cj.hasChildNodes())cj.removeChild(cj.lastChild);cj.removeAttribute("ws-hole");return ch(cj,null);}}function ca(ce){if(!ce.hasAttribute("ws-preserve"))if(bH.StartsWith(ce.nodeName.toLowerCase(),"ws-"))cc(ce);else{bn.convertAttrs(ce);cb(ce.firstChild);}}function cb(ce){return b_(0,ce);}function cc(ce){return b_(1,ce);}function cd(ce){var cf,cg,ch,ci;while(true){cf=ce.querySelector("[ws-template]");if(bN.Equals(cf,null)){cg=ce.querySelector("[ws-children-template]");if(bN.Equals(cg,null))return null;else{ch=cg.getAttribute("ws-children-template");cg.removeAttribute("ws-children-template");bm.PrepareTemplateStrict(b5,{$:1,$0:ch},cg,null);ce=ce;}}else{ci=cf.getAttribute("ws-template");(bm.PrepareSingleTemplate(b5,{$:1,$0:ci},cf))(null);ce=ce;}}}b9=(b6==null?"":b6.$0).toLowerCase();bm.LoadedTemplateFile(b5).set_Item(b9,b7);if(b7.hasChildNodes()){cd(b7);cb(b7.firstChild);}};bm.FakeRootSingle=function(b5){var b6,b7,b8,b9;b5.removeAttribute("ws-template");b6=b5.getAttribute("ws-replace");if(b6===null);else{b5.removeAttribute("ws-replace");b7=b5.parentNode;bN.Equals(b7,null)?void 0:(b8=self.document.createElement(b5.tagName),b8.setAttribute("ws-replace",b6),b7.replaceChild(b8,b5));}b9=self.document.createElement("div");b9.appendChild(b5);return b9;};bm.FakeRoot=function(b5){var b6;b6=self.document.createElement("div");while(b5.hasChildNodes())b6.appendChild(b5.firstChild);return b6;};bm.ChildrenTemplate=function(b5,b6){var b7,b8,b9,b_,b$;b7=bm.InlineTemplate(b5,bL.append(b6,bm.GlobalHoles().Values()));b8=b7[1];b9=b7[0];b_=b9.Els;return!bN.Equals(b_,null)&&b_.length===1&&(bF.get(b_,0)instanceof bY&&(bN.Equals(bF.get(b_,0).nodeType,bY.ELEMENT_NODE)&&(b$=bF.get(b_,0),true)))?bj.TreeNode(b9,b8):bi.Mk({$:6,$0:b9},b8);};bm.InlineTemplate=function(b5,b6){var b7,b8,b9,b_,cb,cc,cd,ce,cf,cg,ch;function b$(ci,cj){var ck,cl,cm;ck=_6.Insert(ci,cj);cc.push(_6.Updates(ck));cd.push([ci,ck]);cl=bM.GetOptional(ck.OnAfterRender);return cl==null?null:(cm=cl.$0,void ce.push(function(){cm(ci);}));}function ca(ci){var cj,ck;cj=(ck=null,[cf.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);return cj[0]?cj[1].$==0?{$:1,$0:cj[1].$1}:cj[1].$==1?{$:1,$0:bi.TextNode(cj[1].$1)}:cj[1].$==2?{$:1,$0:bi.TextView(cj[1].$1)}:cj[1].$==10?{$:1,$0:bi.TextView(cj[1].$1.get_View())}:cj[1].$==11?{$:1,$0:bi.TextView(y.Map(a.String,cj[1].$1.get_View()))}:cj[1].$==12?{$:1,$0:bi.TextView(y.Map(function(cl){return cl.get_Input();},cj[1].$1.get_View()))}:cj[1].$==13?{$:1,$0:bi.TextView(y.Map(a.String,cj[1].$1.get_View()))}:cj[1].$==14?{$:1,$0:bi.TextView(y.Map(function(cl){return cl.get_Input();},cj[1].$1.get_View()))}:cj[1].$==15?{$:1,$0:bi.TextView(y.Map(a.String,cj[1].$1.get_View()))}:(bO.warn("Content hole filled with attribute data",ci),null):null;}cb=[];cc=[];cd=[];ce=[];cf=new bV.New$5();cg=bG.Get(b6);try{while(cg.MoveNext()){ch=cg.Current();cf.set_Item(ch.$0,ch);}}finally{if(typeof cg=="object"&&"Dispose"in cg)cg.Dispose();}b7=r.ChildrenArray(b5);bm.foreachNotPreserved(b5,"[ws-hole]",function(ci){var cj,ck,cl;cl=ci.getAttribute("ws-hole");ci.removeAttribute("ws-hole");while(ci.hasChildNodes())ci.removeChild(ci.lastChild);cj=ca(cl);if(cj!=null&&cj.$==1){ck=cj.$0;bh.LinkElement(ci,ck.docNode);cb.push(bc.New(_6.Empty(ci),ck.docNode,null,ci,h.Int(),null));cc.push(ck.updates);}});bm.foreachNotPreserved(b5,"[ws-replace]",function(ci){var cj,ck,cl,cm,cn,co;cj=ca(ci.getAttribute("ws-replace"));if(cj!=null&&cj.$==1){ck=cj.$0;cl=ci.parentNode;cm=self.document.createTextNode("");cl.replaceChild(cm,ci);cn=bh.InsertBeforeDelim(cm,ck.docNode);co=bF.tryFindIndex(function(cp){return ci===cp;},b7);co==null?void 0:bF.set(b7,co.$0,ck.docNode);cb.push(bc.New(_6.Empty(cl),ck.docNode,{$:1,$0:[cn,cm]},cl,h.Int(),null));cc.push(ck.updates);}});bm.foreachNotPreserved(b5,"[ws-attr]",function(ci){var cj,ck,cl;cj=ci.getAttribute("ws-attr");ci.removeAttribute("ws-attr");ck=(cl=null,[cf.TryGetValue(cj,{get:function(){return cl;},set:function(cm){cl=cm;}}),cl]);if(ck[0])ck[1].$==3?b$(ci,ck[1].$1):bO.warn("Attribute hole filled with non-attribute data",cj);});bm.foreachNotPreserved(b5,"[ws-on]",function(ci){b$(ci,_2.Concat(bF.choose(function(cj){var ck,cl,cm;ck=bH.SplitChars(cj,[":"],1);cl=(cm=null,[cf.TryGetValue(bF.get(ck,1),{get:function(){return cm;},set:function(cn){cm=cn;}}),cm]);return cl[0]?cl[1].$==4?{$:1,$0:_9.Handler(bF.get(ck,0),cl[1].$1)}:cl[1].$==5?{$:1,$0:_2.Handler(bF.get(ck,0),cl[1].$1)}:(bO.warn("Event hole on"+bF.get(ck,0)+" filled with non-event data",bF.get(ck,1)),null):null;},bH.SplitChars(ci.getAttribute("ws-on"),[" "],1))));ci.removeAttribute("ws-on");});bm.foreachNotPreserved(b5,"[ws-onafterrender]",function(ci){var cj,ck,cl;cj=ci.getAttribute("ws-onafterrender");ck=(cl=null,[cf.TryGetValue(cj,{get:function(){return cl;},set:function(cm){cl=cm;}}),cl]);if(ck[0])ck[1].$==7?(ci.removeAttribute("ws-onafterrender"),b$(ci,_9.OnAfterRender(ck[1].$1))):ck[1].$==8?(ci.removeAttribute("ws-onafterrender"),b$(ci,_9.OnAfterRender(ck[1].$1))):bO.warn("onafterrender hole filled with non-onafterrender data",cj);});bm.foreachNotPreserved(b5,"[ws-var]",function(ci){var cj,ck,cl;cj=ci.getAttribute("ws-var");ci.removeAttribute("ws-var");ck=(cl=null,[cf.TryGetValue(cj,{get:function(){return cl;},set:function(cm){cl=cm;}}),cl]);if(ck[0])ck[1].$==10?b$(ci,_9.Value(ck[1].$1)):ck[1].$==11?b$(ci,_9.Checked(ck[1].$1)):ck[1].$==12?b$(ci,_9.IntValue(ck[1].$1)):ck[1].$==13?b$(ci,_9.IntValueUnchecked(ck[1].$1)):ck[1].$==14?b$(ci,_9.FloatValue(ck[1].$1)):ck[1].$==15?b$(ci,_9.FloatValueUnchecked(ck[1].$1)):bO.warn("Var hole filled with non-Var data",cj);});bm.foreachNotPreserved(b5,"[ws-attr-holes]",function(ci){var cj,ck,cl,cm;cj=new a.RegExp(bm.TextHoleRE(),"g");ck=bH.SplitChars(ci.getAttribute("ws-attr-holes"),[" "],1);ci.removeAttribute("ws-attr-holes");for(cl=0,cm=ck.length-1;cl<=cm;cl++)(function(){var cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz;cw=bF.get(ck,cl);cx=ci.getAttribute(cw);cn=null;co=0;cy=[];while(cn=cj.exec(cx),cn!==null){cz=bZ.string(cx,{$:1,$0:co},{$:1,$0:cj.lastIndex-bF.get(cn,0).length-1});co=cj.lastIndex;cy.push([cz,bF.get(cn,1)]);}cq=bZ.string(cx,{$:1,$0:co},null);cj.lastIndex=0;cr=bF.foldBack(function(cA,cB){return(function(cC){var cD,cE;cD=cC[0];cE=cC[1];return function(cF){var cG,cH,cI,cJ,cK;cG=cF[0];cH=cF[1];cI=(cJ=(cK=null,[cf.TryGetValue(cE,{get:function(){return cK;},set:function(cL){cK=cL;}}),cK]),cJ[0]?cJ[1].$==1?{$:0,$0:cJ[1].$1}:cJ[1].$==2?{$:1,$0:cJ[1].$1}:cJ[1].$==10?{$:1,$0:cJ[1].$1.get_View()}:cJ[1].$==11?{$:1,$0:y.Map(a.String,cJ[1].$1.get_View())}:cJ[1].$==12?{$:1,$0:y.Map(function(cL){return cL.get_Input();},cJ[1].$1.get_View())}:cJ[1].$==13?{$:1,$0:y.Map(a.String,cJ[1].$1.get_View())}:cJ[1].$==14?{$:1,$0:y.Map(function(cL){return cL.get_Input();},cJ[1].$1.get_View())}:cJ[1].$==15?{$:1,$0:y.Map(a.String,cJ[1].$1.get_View())}:(bO.warn("Attribute value hole filled with non-text data",cE),{$:0,$0:""}):{$:0,$0:""});return cI.$==1?[cD,new bE.T({$:1,$0:cG===""?cI.$0:y.Map(function(cL){return cL+cG;},cI.$0),$1:cH})]:[cD+cI.$0+cG,cH];};}(cA))(cB);},cy,[cq,bE.T.Empty]);return b$(ci,cr[1].$==1?cr[1].$1.$==1?cr[1].$1.$1.$==1?cr[1].$1.$1.$1.$==0?(cs=cr[0],_9.Dynamic(cw,y.Map3(function(cA,cB,cC){return cs+cA+cB+cC;},cr[1].$0,cr[1].$1.$0,cr[1].$1.$1.$0))):(ct=cr[0],_9.Dynamic(cw,y.Map(function(cA){return ct+bH.concat("",cA);},y.Sequence(cr[1])))):(cu=cr[0],_9.Dynamic(cw,y.Map2(function(cA,cB){return cu+cA+cB;},cr[1].$0,cr[1].$1.$0))):cr[0]===""?_9.Dynamic(cw,cr[1].$0):(cv=cr[0],_9.Dynamic(cw,y.Map(function(cA){return cv+cA;},cr[1].$0))):_2.Create(cw,cr[0]));}());});return[bM.DeleteEmptyFields({Els:b7,Dirty:true,Holes:cb,Attrs:cd,Render:(b8=ce.length==0?null:{$:1,$0:function(ci){bF.iter(function(cj){cj(ci);},ce);}},b8?b8.$0:void 0),El:(b9=!bN.Equals(b7,null)&&b7.length===1&&(bF.get(b7,0)instanceof bY&&(bF.get(b7,0)instanceof a.Element&&(b_=bF.get(b7,0),true)))?{$:1,$0:b_}:null,b9?b9.$0:void 0)},["Render","El"]),d.TreeReduce(y.Const(),y.Map2Unit,cc)];};bm.foreachNotPreserved=function(b5,b6,b7){r.IterSelector(b5,b6,function(b8){if(b8.closest("[ws-preserve]")==null)b7(b8);});};bm.TextHoleRE=function(){bo.$cctor();return bo.TextHoleRE;};bm.GlobalHoles=function(){bo.$cctor();return bo.GlobalHoles;};bm.set_GlobalHoles=function(b5){bo.$cctor();bo.GlobalHoles=b5;};bm.LocalTemplatesLoaded=function(){bo.$cctor();return bo.LocalTemplatesLoaded;};bm.set_LocalTemplatesLoaded=function(b5){bo.$cctor();bo.LocalTemplatesLoaded=b5;};bm.LoadedTemplateFile=function(b5){var b6,b7,b8;b6=(b7=null,[bm.LoadedTemplates().TryGetValue(b5,{get:function(){return b7;},set:function(b9){b7=b9;}}),b7]);return b6[0]?b6[1]:(b8=new bV.New$5(),(bm.LoadedTemplates().set_Item(b5,b8),b8));};bm.LoadedTemplates=function(){bo.$cctor();return bo.LoadedTemplates;};bo.$cctor=function(){bo.$cctor=a.ignore;bo.LoadedTemplates=new bV.New$5();bo.LocalTemplatesLoaded=false;bo.GlobalHoles=new bV.New$5();bo.TextHoleRE="\\${([^}]+)}";bo.RenderedFullDocTemplate=null;};bp=c.Flow=bM.Class({get_Render:function(){return this.render;}},k,bp);bp.New=bM.Ctor(function(b5){bp.New$1.call(this,function(b6){return function(b7){return A.Set(b6,b5(b7));};});},bp);bp.New$1=bM.Ctor(function(b5){k.New.call(this);this.render=b5;},bp);bp.get_Do=function(){return new bq.New();};bp.Static=function(b5){return new bp.New$1(function(b6){return function(b7){A.Set(b6,b5);return b7();};});};bp.Define=function(b5){return new bp.New(function(b6){return b5(function(b7){b6(b7);});});};bp.Embed=function(b5){var b6;b6=A.Create$1(bi.get_Empty());((b5.get_Render())(b6))(a.ignore);return bi.EmbedView(b6.get_View());};bp.Return=function(b5){return new bp.New$1(function(){return function(b6){return b6(b5);};});};bp.Bind=function(b5,b6){return new bp.New$1(function(b7){return function(b8){return((b5.get_Render())(b7))(function(b9){((b6(b9).get_Render())(b7))(b8);});};});};bp.Map=function(b5,b6){return new bp.New$1(function(b7){return function(b8){return((b6.get_Render())(b7))(function(b9){b8(b5(b9));});};});};bq=c.FlowBuilder=bM.Class({ReturnFrom:a.id,Return:function(b5){return bp.Return(b5);},Bind:function(b5,b6){return bp.Bind(b5,b6);}},k,bq);bq.New=bM.Ctor(function(){k.New.call(this);},bq);bs=br.attr=bM.Class({},k,bs);bs.New=bM.Ctor(function(){k.New.call(this);},bs);bt.InstallHash=function(b5,b6){var b7;b7=A.Create$1(void 0);bt.InstallHashInto(b7,b5,b6);return b7;};bt.InstallHashInto=function(b5,b6,b7){function b8(b$){return b1.Parse(b7,b2.FromHash(b$,{$:1,$0:true}));}function b9(){return bt.getCurrentHash(b8,b6);}function b_(b$){if(!bN.Equals(b5.Get(),b$))b5.Set(b$);}b_(b9());self.addEventListener("popstate",function(){return b_(b9());},false);self.addEventListener("hashchange",function(){return b_(b9());},false);self.document.body.addEventListener("click",function(b$){var ca,cb,cc;ca=(cb=bt.findLinkHref(b$.target),cb==null?null:(cc=cb.$0,bH.StartsWith(cc,"#")?b8(cc):null));return ca==null?null:(b_(ca.$0),b$.preventDefault());},false);y.Sink(function(b$){var ca;if(!bN.Equals(b$,b9())){ca=b1.HashLink(b7,b$);self.history.pushState(null,null,ca);}},b5.get_View());};bt.getCurrentHash=function(b5,b6){var b7,b8;b7=self.location.hash;b8=b5(b7);return b8==null?((function(b9){return function(b_){return b9("Failed to parse route: "+b3.toSafe(b_));};}(function(b9){bO.log(b9);}))(b7),b6):b8.$0;};bt.Install=function(b5,b6){var b7;b7=A.Create$1(void 0);bt.InstallInto(b7,b5,b6);return b7;};bt.InstallInto=function(b5,b6,b7){function b8(b$){return b1.Parse(b7,b$);}function b9(){return bt.getCurrent(b8,b6);}function b_(b$){if(!bN.Equals(b5.Get(),b$))b5.Set(b$);}b_(b9());self.addEventListener("popstate",function(){return b_(b9());},false);self.document.body.addEventListener("click",function(b$){var ca,cb,cc;ca=(cb=(cc=bt.findLinkHref(b$.target),cc==null?null:bt.hrefToAbsolute(cc.$0)),cb==null?null:b8(b2.FromUrl(cb.$0,null)));return ca==null?null:(b_(ca.$0),b$.preventDefault());},false);y.Sink(function(b$){var ca;if(!bN.Equals(b$,b9())){ca=b1.Link(b7,b$);self.history.pushState(null,null,ca);}},b5.get_View());};bt.findLinkHref=function(b5){while(true)if(b5.tagName==="A")return b4.ofObj(b5.getAttribute("href"));else if(b5===self.document.body)return null;else b5=b5.parentNode;};bt.hrefToAbsolute=function(b5){var b6;return bH.StartsWith(b5,"?")?{$:1,$0:bt.trimFragment(self.location.pathname+b5)}:bH.StartsWith(b5,"#")?null:bH.StartsWith(b5,"/")?{$:1,$0:bt.trimFragment(b5)}:(new a.RegExp("^[a-zA-Z0-9]:")).test(b5)?null:(b6=self.location.pathname,{$:1,$0:bt.trimFragment(bZ.string(b6,null,{$:1,$0:b6.lastIndexOf("/")})+b5)});};bt.trimFragment=function(b5){var b6;b6=b5.indexOf("#");return b6===-1?b5:bZ.string(b5,null,{$:1,$0:b6-1});};bt.getCurrent=function(b5,b6){var b7,b8,b9;b7=self.location;b8=b2.FromUrl(b7.pathname+b7.search,null);b9=b5(b8);return b9==null?((function(b_){return function(b$){return b_("Failed to parse route: "+b3.toSafe(b$));};}(function(b_){bO.log(b_);}))(b8.ToLink()),b6):b9.$0;};bu.Append=function(b5,b6){return{$:0,$0:p.Append(b5.$0,b6.$0),$1:bQ.FoldBack(function(b7,b8,b9){return b9.Add$1(b7,b8);},b5.$1,b6.$1)};};bu.FromList=function(b5,b6){return{$:0,$0:p.FromArray(bF.ofList(b5)),$1:b6};};bu.ToList=function(b5){return[bE.ofArray(p.ToArray(b5.$0)),b5.$1];};bu.SameHash=function(b5,b6){return bu.NoHash(b5)===bu.NoHash(b6);};bu.MakeHash=function(b5){var b6,b7;b6=b5.$1;b7=bH.concat("/",bF.map(function(b8){return a.encodeURIComponent(b8);},p.ToArray(b5.$0)));return b6.get_IsEmpty()?b7:b7+"?"+bH.concat("&",bL.map(function(b8){var b9;b9=bS.KeyValue(b8);return a.encodeURIComponent(b9[0])+"="+a.encodeURIComponent(b9[1]);},b6));};bu.ParseHash=function(b5){var b6,b7,b8,b9;b6=bu.NoHash(b5);b7=(b8=b6.indexOf("?"),b8===-1?[b6,""]:[bZ.string(b6,null,{$:1,$0:b8-1}),bZ.string(b6,{$:1,$0:b8+1},null)]);b9=b7[0];return{$:0,$0:p.FromArray(b9===""?[]:bF.map(function(b_){return a.decodeURIComponent(b_);},bH.SplitChars(b9,["/"],0))),$1:bQ.OfArray(bF.map(function(b_){var b$;b$=b_.indexOf("=");return b$===-1?[a.decodeURIComponent(b_),""]:[a.decodeURIComponent(bZ.string(b_,null,{$:1,$0:b$-1})),a.decodeURIComponent(bZ.string(b_,{$:1,$0:b$+1},null))];},bH.SplitChars(b7[1],["&"],0)))};};bu.NoHash=function(b5){return bH.StartsWith(b5,"#")?b5.substring(1):b5;};bv.DoLink=function(b5,b6){var b7;b7=b5.Ser(b6);return bu.FromList(b7[0],b7[1]);};bv.DoRoute=function(b5,b6){return b5.Des(bu.ToList(b6));};bv.InstallMap=function(b5){var b6;function b7(b$,ca){return bN.Equals(b5.Ser(b$),b5.Ser(ca));}function b8(){return b5.Des(bu.ToList(bu.ParseHash(self.location.hash)));}function b9(b$){if(!b7(b6.Get(),b$))b6.Set(b$);}function b_(b$){return b9(b8());}b6=A.Create$1(b8());self.onpopstate=b_;self.onhashchange=b_;y.Sink(function(b$){var ca,cb;ca=bu.MakeHash((cb=b5.Ser(b$),bu.FromList(cb[0],cb[1])));if(!bu.SameHash(self.location.hash,ca))self.location.replace("#"+ca);},b6.get_View());return b6;};bw.Install=function(b5){return bv.InstallMap(b5);};bw.Create=function(b5,b6){function b7(b8){return b8[0];}return{Des:function(b8){return b6(b7(b8));},Ser:function(b8){return[b5(b8),new bR.New([])];}};};bw.CreateWithQuery=function(b5,b6){return{Des:b6,Ser:b5};};by.New=function(b5,b6){return{Active:b5,PosV:b6};};bz.New=function(b5,b6,b7,b8){return{Active:b5,Left:b6,Middle:b7,Right:b8};};bA.get_MousePressed=function(){bx.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bM.Curried3(function(b5,b6,b7){return b5||b6||b7;})),bx.MouseBtnSt$1().Left.get_View()),bx.MouseBtnSt$1().Middle.get_View()),bx.MouseBtnSt$1().Right.get_View());};bA.get_RightPressed=function(){bx.ActivateButtonListener();return bx.MouseBtnSt$1().Right.get_View();};bA.get_MiddlePressed=function(){bx.ActivateButtonListener();return bx.MouseBtnSt$1().Middle.get_View();};bA.get_LeftPressed=function(){bx.ActivateButtonListener();return bx.MouseBtnSt$1().Left.get_View();};bA.get_Position=function(){!bx.MousePosSt$1().Active?(self.document.addEventListener("mousemove",function(b5){return A.Set(bx.MousePosSt$1().PosV,[b5.clientX,b5.clientY]);}),bx.MousePosSt$1().Active=true):void 0;return bx.MousePosSt$1().PosV.get_View();};bB.New=function(b5,b6,b7){return{KeysPressed:b5,KeyListenerActive:b6,LastPressed:b7};};bC.IsPressed=function(b5){function b6(b7){return b7===b5;}bx.ActivateKeyListener();return y.Map(function(b7){return bE.exists(b6,b7);},bx.KeyListenerState().KeysPressed.get_View());};bC.get_LastPressed=function(){bx.ActivateKeyListener();return bx.KeyListenerState().LastPressed.get_View();};bC.get_KeysPressed=function(){bx.ActivateKeyListener();return bx.KeyListenerState().KeysPressed.get_View();};bx.ActivateKeyListener=function(){bD.$cctor();return bD.ActivateKeyListener;};bx.KeyListenerState=function(){bD.$cctor();return bD.KeyListenerState;};bx.ActivateButtonListener=function(){bD.$cctor();return bD.ActivateButtonListener;};bx.MouseBtnSt$1=function(){bD.$cctor();return bD.MouseBtnSt;};bx.MousePosSt$1=function(){bD.$cctor();return bD.MousePosSt;};bD.$cctor=function(){bD.$cctor=a.ignore;function b5(b6,b7){var b8;b8=b6.button;return b8===0?A.Set(bx.MouseBtnSt$1().Left,b7):b8===1?A.Set(bx.MouseBtnSt$1().Middle,b7):b8===2?A.Set(bx.MouseBtnSt$1().Right,b7):null;}bD.MousePosSt=by.New(false,A.Create$1([0,0]));bD.MouseBtnSt=bz.New(false,A.Create$1(false),A.Create$1(false),A.Create$1(false));bD.ActivateButtonListener=!bx.MouseBtnSt$1().Active?(bx.MouseBtnSt$1().Active=true,self.document.addEventListener("mousedown",function(b6){return b5(b6,true);}),self.document.addEventListener("mouseup",function(b6){return b5(b6,false);})):null;bD.KeyListenerState=bB.New(A.Create$1(bE.T.Empty),false,A.Create$1(-1));bD.ActivateKeyListener=!bx.KeyListenerState().KeyListenerActive?(bx.KeyListenerState().KeyListenerActive=true,self.document.addEventListener("keydown",function(b6){var b7,b8,b9;b7=b6.which;b8=b7===null?b6.keyCode:b7;A.Set(bx.KeyListenerState().LastPressed,b8);b9=bx.KeyListenerState().KeysPressed.Get();return!bE.exists(function(b_){return b_===b8;},b9)?bx.KeyListenerState().KeysPressed.Set(bE.append(b9,bE.ofArray([b8]))):null;}),self.document.addEventListener("keyup",function(b6){var b7,b8;function b9(b_){return b_!==b8;}b7=b6.which;b8=b7===null?b6.keyCode:b7;return A.Update(bx.KeyListenerState().KeysPressed,function(b_){return bE.filter(b9,b_);});})):null;};}(self));
